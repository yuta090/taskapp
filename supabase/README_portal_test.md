# ポータルダッシュボード テストデータ

## 概要

`seed_portal_test.sql` は、クライアントポータルの全表示パターンを確認するためのテストデータです。

## 前提条件

### 1. クライアントユーザーの作成

Supabase Dashboard > Authentication > Users で以下のユーザーを作成してください：

| フィールド | 値 |
|-----------|-----|
| Email | client2@client.com |
| Password | （任意のパスワード） |
| Auto Confirm | ON |

### 2. 実行方法

```bash
# Supabase CLIを使用
supabase db execute --file supabase/seed_portal_test.sql

# または Supabase Dashboard > SQL Editor で実行
```

## 作成されるテストデータ

### ヘルス状態パターン

| 状態 | 条件 | テストデータ |
|------|------|-------------|
| **needs_attention** (要対応) | 期限切れ3件以上 or 5日以上待機 | 期限切れタスク2件 + 6日待機タスク1件 |
| **at_risk** (注意) | 期限切れ1件以上 or 3日以上待機 | 上記より軽いケース |
| **on_track** (順調) | 期限切れ0件 & 待機3日未満 | タスクをクリアした後の状態 |

### タスクパターン（ball=client / 要確認）

| パターン | タスク名 | 状態 |
|----------|---------|------|
| 期限5日超過 | 商品一覧ページのデザイン確認 | 🔴 期限切れ |
| 期限3日超過 | 決済フローの仕様確認（仕様） | 🔴 期限切れ |
| 本日期限 | トップページバナー画像の選定 | 🟡 今日 |
| 3日後期限 | お問い合わせフォームの項目確認 | 🟢 近日 |
| 6日待機 | マイページ機能の仕様承認（仕様） | ⚠️ 長期待機 |
| 期限なし | ロゴの色味調整案の確認 | 📋 期限なし |

### タスクパターン（ball=internal / チーム対応中）

| タスク名 | ステータス |
|---------|----------|
| 商品詳細ページのコーディング | in_progress |
| カート機能の実装 | in_progress |
| データベース設計 | in_progress |
| API設計書作成 | todo |

### 完了済みタスク

5件の完了タスク（進捗バー用）

### マイルストーン

| マイルストーン | 状態 | 期限 |
|---------------|------|------|
| 要件定義完了 | ✅ 完了 | 30日前 |
| UI/UXデザイン完了 | 🔄 進行中 | 7日後 |
| フロントエンド実装 | ⏳ 予定 | 30日後 |
| バックエンド実装 | ⏳ 予定 | 45日後 |
| テスト・リリース | ⏳ 予定 | 60日後 |

### アクティビティフィード

過去の承認履歴5件（承認4件 + 修正依頼1件）

## 表示確認チェックリスト

ログイン後、以下が表示されることを確認：

- [ ] **ヘルスバッジ**: 「要対応」（赤）が表示される
- [ ] **アラート**: 「期限切れ: 2件」「次の期限: 今日」が表示される
- [ ] **アクションカード**: 6件のタスクが表示される
  - [ ] 期限切れタスクに赤いラベル
  - [ ] 仕様タスクに紫のラベル
  - [ ] 待機日数が表示される
- [ ] **プログレスバー**: 5/15（約33%）が表示される
- [ ] **マイルストーンタイムライン**: 5件表示される
  - [ ] 完了（グリーン）、進行中（アンバー）、予定（グレー）
- [ ] **ボール所有**: クライアント6件 / チーム4件
- [ ] **アクティビティフィード**: 最新5件が表示される
- [ ] **承認履歴**: 承認4件が表示される

## データのリセット

```sql
-- テストデータを削除（スペースIDで絞り込み）
DELETE FROM audit_logs WHERE space_id = 'aaaaaaaa-0000-0000-0000-000000000001';
DELETE FROM tasks WHERE space_id = 'aaaaaaaa-0000-0000-0000-000000000001';
DELETE FROM milestones WHERE space_id = 'aaaaaaaa-0000-0000-0000-000000000001';
DELETE FROM space_memberships WHERE space_id = 'aaaaaaaa-0000-0000-0000-000000000001';
DELETE FROM spaces WHERE id = 'aaaaaaaa-0000-0000-0000-000000000001';
```

## 状態を変更してテスト

### 「順調」状態にする

```sql
-- 期限切れタスクを承認（done）にする
UPDATE tasks SET status = 'done', ball = 'internal'
WHERE id IN (
  'cccccccc-0001-0000-0000-000000000001',
  'cccccccc-0002-0000-0000-000000000001'
);

-- 長期待機タスクも承認
UPDATE tasks SET status = 'done', ball = 'internal'
WHERE id = 'cccccccc-0005-0000-0000-000000000001';
```

### 「注意」状態にする

```sql
-- 期限切れを1件だけ残す
UPDATE tasks SET status = 'done', ball = 'internal'
WHERE id = 'cccccccc-0001-0000-0000-000000000001';
```

# プロジェクト設定

## 設定画面の概要

プロジェクト設定画面では、プロジェクト（Space）に関する各種設定を管理します。左ナビゲーションの設定アイコンからアクセスできます。

### 画面構成

設定画面は **サイドバーナビ + コンテンツエリア** の2カラム構成です。

```
┌──────────────┬──────────────────────────┐
│ サイドバーナビ  │ コンテンツエリア            │
│ (200px)      │ (flex-1, max-800px)      │
│              │                          │
│ [検索バー]    │ [セットアップバナー]        │
│              │ ┌────────────────────────┐│
│ プロジェクト運用│ │                        ││
│  基本設定     │ │ 選択中のセクション        ││
│  マイルストーン │ │                        ││
│  メンバー     │ │                        ││
│              │ └────────────────────────┘│
│ 外部連携    ⚠3│                          │
│  GitHub   🟢 │                          │
│  Slack    ⚪ │                          │
│  Calendar ⚪ │                          │
│  ビデオ会議 ⚪│                          │
│              │                          │
│ AI・自動化    │                          │
│  AI設定      │                          │
│              │                          │
│ セキュリティ   │                          │
│  APIキー     │                          │
│              │                          │
│ データ管理    │                          │
│  エクスポート  │                          │
└──────────────┴──────────────────────────┘
```

### カテゴリとセクション

| カテゴリ | セクション | 内容 |
|---------|-----------|------|
| **プロジェクト運用** | 基本設定 | プロジェクト名の変更、プリセット（初期テンプレート）設定 |
| | マイルストーン | フェーズ管理（名前・開始日・期限） |
| | メンバー | メンバーの招待・ロール管理 |
| **外部連携** | GitHub | GitHub リポジトリ連携 |
| | Slack | Slack チャンネル連携・通知設定 |
| | Google Calendar | OAuth連携・FreeBusy表示 |
| | ビデオ会議 | デフォルトプロバイダー設定（Zoom/Teams/Meet） |
| **AI・自動化** | AI設定 | AIプロバイダー・モデル・APIキー |
| **セキュリティ・API** | APIキー | API キー発行・管理（admin のみ） |
| **データ管理** | データエクスポート | CSVエクスポート |

### 接続ステータスバッジ

外部連携の各セクションには、接続状態を示すドットが表示されます。

| ドット | 色 | 意味 |
|--------|-----|------|
| 🟢 | 緑（emerald） | 接続済み・正常 |
| ⚪ | グレー | 未接続 |
| 🟠（点滅） | アンバー | トークン期限切れ間近（7日以内）または期限切れ |

カテゴリヘッダには、対応が必要な項目（未接続 or 期限切れ）の件数がバッジで表示されます。

### 検索機能

サイドバー上部の検索バーで、設定セクションを絞り込めます。

- **日本語キーワード**: 「招待」「通知」「スケジュール」等
- **英語キーワード**: 「Slack」「API」「milestone」等
- **ショートカットキー**: `/` キーまたは `Cmd+K`（Ctrl+K）で検索バーにフォーカス

### セットアップバナー

新規プロジェクトで初期設定が完了していない場合、コンテンツエリア上部にセットアップバナーが表示されます。

| ステップ | 完了条件 | 遷移先 |
|---------|---------|--------|
| メンバーを追加 | メンバーが2人以上 | メンバー設定 |
| マイルストーンを設定 | マイルストーンが1件以上、またはプリセット適用済み | マイルストーン設定 |
| 外部ツールを連携 | いずれかの連携がアクティブ | Slack設定 |

- プログレスバーで進捗を視覚化
- 全ステップ完了で自動的に非表示
- `×` ボタンで手動非表示（プロジェクト単位でlocalStorageに記憶）

---

## 基本設定

プロジェクトの基本情報とテンプレート設定を管理します。

### プロジェクト名の変更

1. サイドバーで「基本設定」を選択する
2. プロジェクト名フィールドを編集する
3. 「保存」ボタンをクリックする

### プリセット（初期テンプレート）

プロジェクト作成時に選択したプリセット情報が表示されます。プリセットにより自動生成されたWikiページやマイルストーンを確認できます。

> **Tips**: プリセットの変更は、マイルストーンやWikiを手動で編集することで対応してください。

---

## マイルストーン設定

プロジェクトのフェーズ（マイルストーン）を管理します。

### プリセットによる自動生成

プロジェクト作成時にプリセット（ジャンル）を選択した場合、そのジャンルに応じたマイルストーンが自動的に作成されます。例えば「Web/アプリ開発」を選択すると、要件定義→設計→開発→テスト→リリースの5つのマイルストーンが自動設定されます。

自動生成されたマイルストーンは通常のマイルストーンと同じく、名前の変更・追加・削除が自由に行えます。

### マイルストーンの追加

1. サイドバーで「マイルストーン」を選択する
2. 「マイルストーンを追加」ボタンをクリックする
3. 以下の項目を入力する

| 項目 | 必須 | 説明 |
|------|------|------|
| マイルストーン名 | 必須 | フェーズやスプリントの名前 |
| 開始日 | 任意 | マイルストーンの開始日（バーンダウンチャートで使用） |
| 期限 | 任意 | マイルストーンの完了期限 |

4. 保存する

> **Tips**: 開始日と期限の両方を設定すると、バーンダウンチャートでタスク消化の進捗を確認できます。ガントチャートでもマイルストーンの期間が可視化されます。

### マイルストーンの編集・削除

- マイルストーン名、開始日、期限はクリックして直接編集できます
- 不要なマイルストーンは削除ボタンで削除できます

> **注意**: マイルストーンを削除しても、そのマイルストーンに紐づいていたタスクは削除されません。タスクのマイルストーン設定が空になります。

### 日付バリデーション

- 開始日が期限より後の場合はエラーが表示されます
- 片方だけの設定も可能です（例: 期限のみ設定）
- 両方未設定のマイルストーンではバーンダウンチャートは利用できません

---

## メンバー管理

プロジェクトのメンバーを管理します。社内メンバーとクライアントの両方をこのセクションで管理します。

### メンバー一覧

サイドバーで「メンバー」を選択すると、現在のプロジェクトメンバーが一覧表示されます。

| 表示項目 | 内容 |
|---------|------|
| 名前 | メンバーの表示名 |
| メールアドレス | 登録メールアドレス |
| ロール | admin / member / client |

### ロールの変更

メンバーのロールを変更できます。

1. 対象メンバーのロール表示をクリックする
2. ドロップダウンから新しいロールを選択する
3. 変更が即時反映される

| ロール | 権限概要 |
|--------|---------|
| **admin** | フルアクセス。設定変更、メンバー招待、全操作が可能 |
| **member** | タスク・会議の操作が可能。設定変更やメンバー招待は不可 |
| **client** | クライアントポータルからの閲覧・コメント・レビューのみ |

> **注意**: ロールの変更は admin 以上の権限が必要です。

### メンバーの削除

1. 対象メンバーの行にある削除ボタンをクリックする
2. 確認ダイアログで「削除」を選択する
3. メンバーがプロジェクトから除外される

> **注意**: メンバーを削除しても、そのメンバーが作成したタスクやコメントは残ります。

### 新規メンバーの招待

1. 招待フォームにメールアドレスを入力する
2. ロール（admin / member / client）を選択する
3. 「招待」ボタンをクリックする
4. 招待メールが送信される

> **Tips**: 招待メールには組織名とプロジェクト名が含まれます。受信者はメール内のリンクから参加できます。招待の有効期限は30日間です。

---

## クライアント管理

クライアントの招待と管理は「メンバー」セクションで、ロールを `client` に設定して行います。

### クライアントの招待

1. サイドバーで「メンバー」を選択する
2. メンバー招待フォームでロールに `client` を選択する
3. クライアント担当者のメールアドレスを入力する
4. 「招待」ボタンをクリックする

### クライアントのアクセス権

| 機能 | アクセス |
|------|---------|
| タスク閲覧 | `ball = 'client'` のタスクを中心に閲覧可能 |
| コメント | タスクへのコメントが可能 |
| レビュー | レビュー対象のタスクを承認・変更依頼可能 |
| 日程調整 | 日程提案への回答が可能 |
| タスク作成・編集 | 不可 |
| 設定変更 | 不可 |

---

## 外部連携設定

外部連携の各セクションは、サイドバーの「外部連携」カテゴリから個別にアクセスします。接続ステータスはサイドバーのドットで一目で確認できます。

### Googleカレンダー連携

Googleカレンダーと連携すると、日程調整時に参加者の空き状況を確認できます。

#### OAuth接続手順

1. サイドバーで「Google Calendar」を選択する
2. 接続状態をステータスバッジで確認する
   - 🟢 緑: 接続済み
   - ⚪ グレー: 未接続
   - 🟠 アンバー点滅: トークン期限切れ間近（再接続推奨）
3. 「Googleカレンダーに接続」ボタンをクリックする
4. Googleの認証画面にリダイレクトされる
5. TaskApp にカレンダーへのアクセスを許可する
6. 設定画面にリダイレクトされ、接続が完了する

#### 接続の解除

1. 「接続を解除」ボタンをクリックする
2. 確認ダイアログで「解除」を選択する

> **注意**: 接続を解除すると、FreeBusy表示やカレンダーイベントの自動作成が利用できなくなります。

### Slack連携

Slack と連携すると、タスクの更新や通知を Slack チャンネルに送信できます。

#### 接続手順

1. サイドバーで「Slack」を選択する
2. Slack ワークスペースとの接続状態を確認する
3. 接続されている場合、ワークスペース名が表示される

#### チャンネル設定

Slack に接続した後、通知を送信するチャンネルを設定します。

1. チャンネル一覧から対象チャンネルを選択する
2. 「リンク」ボタンでプロジェクトとチャンネルを紐づける
3. リンク済みのチャンネルには「リンク済み」が表示される

#### 通知カスタマイズ

チャンネルごとに、どの種類の通知を送信するかをカスタマイズできます。

1. リンク済みチャンネルの設定を開く
2. 各通知タイプのチェックボックスで有効/無効を切り替える
3. 変更は即時反映される

#### Slack接続の解除

1. 「接続を解除」ボタンをクリックする
2. 確認ダイアログで「解除」を選択する
3. 全チャンネルのリンクが解除される

### GitHub連携

GitHub リポジトリとプロジェクトを連携します。

1. サイドバーで「GitHub」を選択する
2. GitHub Appのインストール状態を確認する
3. 接続手順に従ってリポジトリをリンクする

### ビデオ会議プロバイダー

日程調整で使用するビデオ会議ツールのデフォルト設定を管理します。

#### 対応プロバイダー

| プロバイダー | 必要な連携 | 備考 |
|------------|-----------|------|
| Google Meet | Googleカレンダー連携 | カレンダーイベントにビデオ会議を追加する形式 |
| Zoom | Zoom OAuth連携 | ユーザーごとのOAuth接続が必要 |
| Microsoft Teams | Microsoft OAuth連携 | Microsoft 365アカウントが必要 |

#### デフォルトプロバイダーの設定

1. サイドバーで「ビデオ会議」を選択する
2. 各プロバイダーの接続状態を確認する
3. デフォルトプロバイダーを選択する
4. 日程提案作成時にこのプロバイダーが自動選択される

> **Tips**: Google Meet を使用する場合は、Googleカレンダー連携も必要です。サイドバーで「Google Calendar」を選択して先に接続を完了してください。

---

## AI設定

プロジェクトのAI機能に関する設定を管理します。

### 設定手順

1. サイドバーで「AI設定」を選択する
2. AI プロバイダーを選択する（OpenAI など）
3. API キーを入力する
4. 使用するモデルを選択する
5. 「保存」をクリックする

### 設定項目

| 項目 | 説明 |
|------|------|
| プロバイダー | 使用する AI サービス |
| API キー | AI サービスの認証キー |
| モデル | 使用する AI モデルの種類 |

> **注意**: API キーは暗号化されて保存されます。他のメンバーからは閲覧できません。AI 設定は admin ロールのみ変更可能です。

---

## API設定

外部からのAPI連携に必要な設定を管理します。

> **注意**: API設定セクションは admin ロールのユーザーのみ表示されます。

### APIキーの管理

1. サイドバーで「APIキー」を選択する
2. 「新しいAPIキーを発行」ボタンをクリックする
3. APIキーが生成される（一度だけ表示されるため、安全な場所に保存してください）
4. 不要になったAPIキーは「削除」ボタンで無効化する

### APIキーの用途

- MCP サーバーからの接続認証
- 外部ツールとの連携
- 自動化スクリプトからのアクセス

> **注意**: APIキーは発行時に一度だけ表示されます。紛失した場合は新しいキーを発行し、古いキーを削除してください。

---

## エクスポート設定

プロジェクトのデータをエクスポートする機能です。

### エクスポート手順

1. サイドバーで「データエクスポート」を選択する
2. エクスポート対象を選択する（タスク一覧など）
3. エクスポート形式を確認する（CSV 形式）
4. 「エクスポート」ボタンをクリックする
5. ファイルが自動的にダウンロードされる

> **Tips**: エクスポートされたデータには、タスクのタイトル、ステータス、担当者、期限、ボール状態などの情報が含まれます。

---

## 表示設定

### オーナー（責任者）フィールドの表示/非表示

タスクの「責任者」欄の表示/非表示をプロジェクト単位で設定できます。

#### 設定方法

1. サイドバーで「基本設定」を選択する
2. 「責任者欄の表示」で以下のいずれかを選択する

| 選択肢 | 動作 |
|--------|------|
| 組織設定に従う | 組織レベルのデフォルト設定に従う |
| 表示する | このプロジェクトで責任者欄を表示 |
| 表示しない | このプロジェクトで責任者欄を非表示 |

> **注意**: 非表示に設定しても、既存の責任者データは保持されます。通知ルールも引き続き動作します。再度「表示する」に切り替えると、データが復元されます。

#### 責任者とは

| 項目 | 説明 |
|------|------|
| 担当者（assignee） | 今アクションすべき人。1人のみ設定可能 |
| 責任者（owners） | 意思決定者・通知を受ける関係者。複数人設定可能 |

---

## 設定変更の権限

| 設定項目 | admin | member | client |
|---------|-------|--------|--------|
| 基本設定 | 変更可 | 閲覧のみ | アクセス不可 |
| マイルストーン | 変更可 | 閲覧のみ | アクセス不可 |
| メンバー管理 | 変更可 | 閲覧のみ | アクセス不可 |
| 外部連携 | 変更可 | 閲覧のみ | アクセス不可 |
| AI設定 | 変更可 | 閲覧のみ | アクセス不可 |
| API設定 | 変更可 | 非表示 | アクセス不可 |
| エクスポート | 変更可 | 変更可 | アクセス不可 |

> **Tips**: 設定変更ができない場合は、プロジェクトの admin に連絡して権限を確認してください。

---

## 通知設定

### 通知チャンネル

TaskApp では以下の通知チャンネルが利用できます。

| チャンネル | 説明 |
|-----------|------|
| アプリ内通知 | TaskApp 内の通知ベル。常に有効 |
| メール通知 | 登録メールアドレスへの通知 |
| Slack通知 | 連携済みSlackチャンネルへの通知 |

### 通知タイプ

以下のイベントで通知が送信されます。

| イベント | 説明 |
|---------|------|
| タスク作成・更新 | 新規タスクの作成、ステータス変更、ボール変更 |
| レビュー依頼 | レビューの依頼・承認・変更依頼・却下 |
| 会議関連 | 会議の作成、開始、終了 |
| 日程調整 | 提案作成、回答送信、確定、期限切れ、リマインダー |
| コメント | タスクへのコメント追加 |

> **Tips**: 通知が多すぎる場合は、Slack連携で通知チャンネルを分けることで、重要度に応じた通知管理が可能です。

---

## エラー通知について

設定画面でエラーが発生した場合、画面右下にトースト通知が表示されます。

- エラー内容が赤色のトースト（3秒間表示）で通知されます
- `×` ボタンで手動で閉じることもできます
- 操作をブロックしないため、続けて作業が可能です

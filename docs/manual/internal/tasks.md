# タスク管理マニュアル

TaskApp のタスク管理機能について説明します。タスクはプロジェクトの作業単位であり、「誰がボールを持っているか」を明確にすることで、クライアントと社内チームの間の作業進行を可視化します。

---

## 画面構成

TaskApp は **3ペイン固定レイアウト** を採用しています。

| ペイン | 幅 | 役割 |
|--------|-----|------|
| 左ナビ（Left Nav） | 240px 固定 | プロジェクト切替・メニュー |
| メインエリア（Main） | flex-1（可変） | タスク一覧の表示 |
| インスペクター（Inspector） | 400px 固定 | タスク詳細の表示・編集 |

> **注意**: インスペクターは常にメインエリアをリサイズして表示します。メインエリアに覆いかぶさる（オーバーレイ）表示は禁止です。

### URL構造

タスク一覧画面のURLは以下の形式です。

```
/:orgId/project/:spaceId
```

タスクを選択すると、URLにクエリパラメータが追加されます。

```
/:orgId/project/:spaceId?task=<タスクID>
```

---

## タスク一覧

### 表示ルール

- 1行1タスク（行高 32-40px）
- ステータスに応じたアイコンカラーで視覚的に区別
- クライアントに見えるタスクには **Amber-500 バッジ** が表示される

### フィルター・タブ

一覧画面のヘッダーにはフィルタータブがあります。

| タブ | 表示内容 |
|------|----------|
| すべて | 全タスク |
| アクティブ | backlog 以外の進行中タスク |
| バックログ | backlog ステータスのタスク |

---

## タスクの作成

### 手順

1. タスク一覧画面の右上にある **「新規タスク」ボタン** をクリックします
2. **タスク作成シート**（Create Sheet）が表示されます
3. 以下の項目を入力します
4. **「作成」ボタン** をクリックしてタスクを作成します

### 入力項目

| 項目 | 必須 | 説明 |
|------|------|------|
| タイトル | 必須 | タスクの名前。空では作成できません |
| タスクタイプ | 必須 | 「通常タスク」または「仕様タスク」を選択 |
| 期限 | 任意 | 完了期限の日付 |
| 担当者 | 任意 | タスクを実行するメンバー（1名） |
| マイルストーン | 任意 | 所属するマイルストーン |
| ボール | 必須 | 「社内」または「クライアント」 |
| クライアント表示 | 必須 | クライアントポータルに表示するかどうか |
| 担当者（オーナー） | 条件付き | ボールが「クライアント」の場合、クライアント担当者の選択が必須 |
| 説明 | 任意 | タスクの詳細説明 |

### タスクタイプ

#### 通常タスク（task）

一般的な作業タスクです。特別な制約はありません。

#### 仕様タスク（spec）

仕様に関する決定事項を追跡するタスクです。追加の必須項目があります。

| 項目 | 説明 |
|------|------|
| spec_path | 仕様ファイルのパス。`/spec/ファイル名.md#アンカー` の形式が必須 |
| 決定状態 | 「検討中」「決定」「実装済」から選択 |

> **注意**: spec_path は `/spec/` を含み、`#` でアンカーを指定する必要があります。形式が不正な場合はエラーが表示されます。

### マイルストーンの新規作成

タスク作成シートから直接マイルストーンを作成できます。

1. マイルストーン選択欄の横にある **「+」ボタン** をクリック
2. マイルストーン名を入力
3. 期限（任意）を設定
4. **「作成」ボタン** をクリック
5. 作成されたマイルストーンが自動的に選択されます

> **Tips**: タスク作成後、ボールとクライアント担当者の設定は次回の作成時にも引き継がれます。

---

## タスク詳細（インスペクター）

### 開き方

1. タスク一覧でタスク行をクリックします
2. 右ペインにインスペクターが表示されます
3. URLが `?task=<タスクID>` に変更されます

### 閉じ方

- インスペクター右上の **X ボタン** をクリック
- **Esc キー** を押す

### 編集可能な項目

インスペクターでは以下の項目をインライン編集できます。すべての変更は **即時保存（Optimistic Update）** されます。保存ボタンはありません。

| 項目 | 操作方法 |
|------|----------|
| タイトル | タイトルをクリック → 入力 → Enter で確定、Esc でキャンセル |
| ステータス | ドロップダウンから選択 |
| ボール | 「社内」「クライアント」ボタンで切替 |
| マイルストーン | ドロップダウンから選択 |
| 担当者 | ドロップダウンから選択 |
| 責任者（オーナー） | 「編集」リンク → メンバー選択 → 「保存」 |
| 期限 | 日付ピッカーで選択 |
| 説明 | テキストエリアをクリック → 入力 → 「保存」 |

### タスクの削除

1. インスペクター右上のゴミ箱アイコンをクリック
2. 確認ダイアログで「OK」をクリック

> **注意**: 削除は取り消せません。慎重に操作してください。

---

## ボール管理

### 概念

TaskApp の中核概念は「ボール所有権（Ball Ownership）」です。これは「次に誰が行動する必要があるか」を示します。

| プロパティ | 値 | 意味 |
|-----------|-----|------|
| ball | `client` | クライアントの対応待ち |
| ball | `internal` | 社内で対応中 |
| origin | `client` | クライアントが起因で作成されたタスク |
| origin | `internal` | 社内が起因で作成されたタスク |

### Amber ルール

**Amber-500 のバッジやアイコンが付いている要素は、クライアントに見えていることを示します。**

- クライアントポータルに表示されるタスク
- クライアント側の参加者・担当者
- クライアントへのボールパス

### ボールパス操作

インスペクターの「ボール」セクションで切り替えられます。

1. **社内 → クライアント**: クライアントに対応を依頼する場合
2. **クライアント → 社内**: クライアントからの回答を受けて社内で作業を再開する場合

> **注意**: ボールをクライアントに渡す場合、クライアント担当者の設定が必要です。ボールを社内に切り替える際、担当者がクライアントメンバーの場合は警告が表示されます。

---

## ステータスワークフロー

### 通常タスクのステータス

```
backlog → todo → in_progress → in_review → done
（未着手）  （ToDo） （進行中）     （レビュー中） （完了）
```

| ステータス | 日本語表示 | 説明 |
|-----------|-----------|------|
| backlog | 未着手 | まだ作業を開始していないタスク |
| todo | ToDo | 作業開始予定のタスク |
| in_progress | 進行中 | 現在作業中のタスク |
| in_review | レビュー中 | レビュー待ちのタスク |
| done | 完了 | 完了したタスク |
| considering | 検討中 | 仕様検討中（spec タスク用） |

### 仕様タスク（spec）の決定状態

仕様タスクには、通常のステータスに加えて「決定状態」があります。

```
considering → decided → implemented
（検討中）      （決定済み）  （実装済み）
```

#### considering → decided（決定済みにする）

1. インスペクターの仕様タスクセクションで **「決定済みにする」ボタン** をクリック
2. spec_path が設定されている必要があります

#### decided → implemented（実装完了にする）- 2クリック方式

1. **「仕様を確認する」ボタン** をクリック（仕様ページが新しいタブで開きます）
2. 仕様を確認後、**10分以内** に **「実装完了にする」ボタン** をクリック
3. 10分を超えた場合は、再度手順1からやり直してください

> **注意**: この2クリック方式は、実装者が仕様を確認してから完了マークを付けることを保証するための仕組みです。

---

## 担当者とオーナー

### 担当者（Assignee）

- **1名** のみ設定可能
- タスクの実行責任者
- ボールの状態と連動した制約がある:
  - `ball = internal` の場合: 社内メンバーのみ選択可能
  - `ball = client` の場合: 社内メンバー + クライアントメンバーから選択可能

> **注意**: ボールが社内にあるのに担当者がクライアントメンバーの場合、警告が表示されます。担当者を社内メンバーに変更してください。

### オーナー（責任者）

- **複数人** 設定可能
- クライアント側と社内側で分けて管理
- 通知対象として使用される
- プロジェクト設定で表示/非表示を切り替え可能

---

## マイルストーン管理

マイルストーンはタスクをグループ化する単位です。

- タスク作成時またはインスペクターから設定可能
- 各タスクは1つのマイルストーンに紐づけられる
- マイルストーンには期限を設定可能
- ガントビューでマイルストーン単位の進捗を確認可能

---

## ガントビュー

タスクをタイムライン形式で表示する機能です。

- 各タスクの期限を横軸の時間軸上に表示
- マイルストーンごとにグループ化
- タスク間の依存関係を可視化

---

## コメント機能

インスペクターの下部にコメントセクションがあります。

### 機能

- タスクに対してコメントを追加
- 社内メンバーはコメントの可視性を制御可能:
  - クライアントに見えるコメント
  - 社内のみのコメント

---

## クライアント表示設定（Client Scope）

各タスクには「クライアントに表示するかどうか」のトグルがあります。

| 設定 | 説明 |
|------|------|
| deliverable（表示） | クライアントポータルに表示されます |
| internal（非表示） | 内部作業として非表示になります |

> **注意**: クライアントに公開する際は、確認ステップ（プレビュー）を挟む必要があります。即時反映は禁止されています。

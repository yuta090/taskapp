# 会議管理マニュアル

TaskApp の会議管理機能について説明します。会議の作成・進行・記録を一元管理し、決定事項をタスクとして自動追跡します。

---

## 画面構成

会議管理画面のURLは以下の形式です。

```
/:orgId/project/:spaceId/meetings
```

### タブ構成

会議画面には2つのタブがあります。

| タブ | 説明 |
|------|------|
| 会議 | 会議の一覧・作成・管理 |
| 日程調整 | 候補日の提案・調整 |

タブの切り替え時にはインスペクターの選択状態がリセットされます。

---

## 会議一覧

### 表示内容

- 各会議がリスト形式で表示されます
- 会議をクリックすると右ペインにインスペクターが表示されます
- URLに `?meeting=<会議ID>` が追加されます

### 会議のステータス

| ステータス | 表示名 | 説明 |
|-----------|--------|------|
| planned | 予定 | 会議がスケジュールされた状態 |
| in_progress | 進行中 | 会議が開始された状態 |
| ended | 終了 | 会議が終了した状態 |

---

## 会議の作成

### 手順

1. 会議タブのヘッダー右側にある **「新規会議」ボタン** をクリック
2. 会議作成シートが表示されます
3. 必要な情報を入力します
4. **「作成」ボタン** をクリック
5. 作成された会議がインスペクターに表示されます

### 入力項目

| 項目 | 必須 | 説明 |
|------|------|------|
| 会議タイトル | 必須 | 会議の名前（デフォルト: 「新規会議 YYYY/MM/DD」） |
| 開催日時 | 任意 | datetime-local 形式で指定（デフォルト: 現在日時） |
| クライアント参加者 | **必須** | クライアント側の参加者を1名以上選択 |
| 社内参加者 | 任意 | 社内メンバーの参加者を選択 |

> **注意**: クライアント参加者が0名の場合は保存できません。エラーメッセージ「クライアント参加者を1名以上選択してください」が表示されます。これは会議の目的がクライアントとの合意形成にあるためです。

### 参加者の選択方法

1. 名前のボタンをクリックして選択/解除を切り替えます
2. 選択中の参加者はハイライト表示されます
3. クライアント参加者は Amber 背景、社内参加者はグレー背景で表示されます

---

## 会議インスペクター

会議をクリックすると右ペインにインスペクターが表示されます。3つのタブがあります。

### 概要タブ

以下の情報を表示します。

- 会議タイトルとステータス
- 開催日時（開始・終了時刻）
- 参加者リスト（クライアント / 社内に分類）
- アクションボタン（開始 / 終了）

### 議事録タブ

- Markdown 形式の議事録を表示します
- 議事録が未入力の場合は「議事録はありません」と表示されます

### 決定事項タブ

- 会議の決定事項サマリーを表示します
- 会議終了前は「決定事項はありません」「会議終了後に生成されます」と表示されます

---

## 会議の開始

### 前提条件

- ステータスが `planned`（予定）であること
- クライアント参加者が1名以上いること

> **注意**: クライアント参加者がいない場合、「クライアント参加者を追加してください」というメッセージが表示され、開始ボタンは無効になります。

### 手順

1. 会議インスペクターの概要タブを開きます
2. **「会議を開始」ボタン** をクリックします
3. ステータスが `in_progress`（進行中）に変わります
4. これにより、決定事項の記録が可能になります

---

## 会議の終了

### 手順

1. 会議インスペクターの概要タブを開きます
2. **「会議を終了」ボタン** をクリックします
3. ステータスが `ended`（終了）に変わります

### 終了時の自動処理

会議終了時に以下の処理が自動で実行されます。

1. **サマリー生成**: 決定済み件数と未決定件数が集計されます
2. **通知の送信**: 参加者全員に通知が送られます

> **Tips**: 通知は冪等性が保証されています。誤って終了操作を複数回行っても、通知は1回だけ送信されます（dedupe_key による重複防止）。

### 通知の受信者

| 対象 | 条件 |
|------|------|
| 会議参加者全員 | 必ず通知を受信 |
| 未決タスクの担当者 | 会議に参加していなくても通知を受信 |

> **注意**: クライアントへの通知にはクライアント向けの文面が使用されます。社内専用の情報は含まれません。

### 通知内容

- 決定件数・未決件数
- 未決タスクは期限が近い順に並び、期限なしは最後に表示
- `ball = client` の未決タスクが優先的に上位に表示

---

## 議事録機能

### Markdown 形式での記入

議事録は Markdown 形式で記入します。通常のテキストに加え、特別な記法でタスクを自動生成できます。

### SPEC 記法によるタスク自動生成

議事録に以下の形式で記述すると、仕様タスクが自動生成されます。

```markdown
- [ ] SPEC(/spec/ファイル名.md#アンカー): タスクタイトル
```

#### 記法の詳細

```markdown
- [ ] SPEC(/spec/REVIEW_SPEC.md#meeting-minutes): レビュー仕様の議事録セクションを更新
- [ ] SPEC(/spec/API_SPEC.md#auth): 認証APIの仕様を確定（期限: 02/15, 担当: 田中）
```

| 要素 | 必須 | 説明 |
|------|------|------|
| `- [ ]` | 必須 | 未チェックのチェックボックス。チェック済み `[x]` は無視されます |
| `SPEC(...)` | 必須 | 仕様ファイルのパスを指定 |
| パス形式 | 必須 | `/spec/` で始まり `#` でアンカーを含む |
| タイトル | 必須 | コロン `:` の後のテキスト |
| 期限 | 任意 | `（期限: MM/DD）` または `（期限: YYYY/MM/DD）` |
| 担当 | 任意 | `（担当: 名前）` |

#### タスクマーカーによる重複防止

タスクが生成されると、行末に自動でマーカーが追加されます。

```markdown
- [ ] SPEC(/spec/API_SPEC.md#auth): 認証APIを確定 <!--task:t001-->
```

このマーカーにより、議事録を再処理しても同じ行からタスクが重複生成されることはありません。

> **Tips**: `[x]`（チェック済み）に変更した行は、次回の処理でスキップされます。

---

## 決定事項の記録

### 会議内での決定（spec_decided）

会議中に仕様の決定が行われた場合、以下の情報が記録されます。

| 項目 | 説明 |
|------|------|
| イベント種類 | `spec_decided` |
| エビデンス | `meeting`（会議での決定） |
| meeting_id | 決定が行われた会議のID |

> **注意**: 決定内容が空の場合は、決定済みとして記録できません。

### 入力者と意思決定者の分離

会議での決定記録は、「誰が入力したか」と「誰の決定か」を分離して管理します。

| フィールド | 説明 |
|-----------|------|
| actor_id | 入力した人（社内スタッフ） |
| on_behalf_of | 意思決定者の立場（`client` / `internal`） |
| client_confirmed_by | 確認したクライアント担当者 |

### クライアント確定として登録

会議外でクライアントの決定を代理入力する場合は、以下が必須です。

1. **確認相手**: 決定を確認したクライアント担当者を選択
2. **根拠**: 決定の根拠を記載（メール、電話等）
3. **決定内容**: 具体的な決定内容を記載

> **注意**: これらの項目はすべて必須です。空のまま登録することはできません。

---

## 日程調整

### 概要

「日程調整」タブでは、会議の候補日時を提案し、参加者からの回答を集約できます。

### 日程調整の作成

1. **「+ 新規日程調整」ボタン** をクリック
2. 調整内容を入力
3. 候補日時を設定
4. **「作成」ボタン** をクリック

### 日程の確定

1. 日程調整一覧から対象の調整をクリック
2. インスペクターで回答状況を確認
3. 最適な日程を選択して確定

---

## よくある操作の流れ

### 標準的な会議フロー

1. **会議を作成**: 参加者を設定して会議を作成
2. **会議を開始**: 全員が揃ったら「会議を開始」をクリック
3. **議事録を記録**: SPEC 記法を活用して仕様タスクを定義
4. **決定事項を記録**: 仕様の決定をエビデンス付きで記録
5. **会議を終了**: 「会議を終了」をクリック → 通知が自動送信

### 会議後のフォローアップ

1. 自動生成されたタスクを確認
2. 各タスクに担当者・期限を設定
3. ボールを適切な側（社内/クライアント）に設定

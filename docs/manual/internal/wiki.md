# Wiki・仕様管理マニュアル

TaskApp の Wiki 機能について説明します。Wiki はプロジェクトの仕様書やドキュメントを一元管理するための機能です。タスクとの連携により、仕様決定の追跡が可能です。

---

## 概要と目的

Wiki は以下の目的で使用します。

- **仕様書の管理**: API仕様、DB設計、UI仕様などのドキュメントを集約
- **決定事項の記録**: プロジェクトの重要な決定を文書化
- **チーム間の情報共有**: 社内メンバーとクライアントが共通の仕様を参照
- **変更履歴の追跡**: バージョン管理による変更の追跡

### URL構造

```
/:orgId/project/:spaceId/wiki
```

ページを選択すると、URLにクエリパラメータが追加されます。

```
/:orgId/project/:spaceId/wiki?page=<ページID>
```

---

## Wiki テンプレートの仕組み

Wiki ページのテンプレートは、プロジェクト作成時に選択した **プリセット（ジャンル）** によって決まります。

### プリセットによる自動生成（推奨）

プロジェクト作成時にプリセットを選択すると、そのジャンルに最適化された Wiki テンプレートが **作成時に自動生成** されます。

#### 主なプリセットと Wiki テンプレート

| プリセット | 自動生成されるページ |
|-----------|-------------------|
| Web/アプリ開発 | API仕様書, DB設計書, UI仕様書, インフラ構成図, ホーム |
| 業務システム開発 | 要件定義書, DB設計書, 画面一覧, テスト計画書, ホーム |
| デザイン制作 | デザインブリーフ, スタイルガイド, 成果物一覧, ホーム |
| コンサルティング | 調査レポート, 提案資料, 議事録テンプレート, ホーム |
| マーケティング | キャンペーン計画, KPI管理, コンテンツカレンダー, ホーム |
| イベント企画 | 企画書, タイムライン, 備品・手配リスト, ホーム |
| 士業 | 契約書チェックリスト, 確認事項一覧, 期日管理表, ホーム |
| 映像制作 | 企画書/構成表, 制作進行表, 納品仕様書, ホーム |
| 建設・建築 | 設計概要, 仕様書, 変更履歴, 検査チェックリスト, ホーム |
| 白紙から始める | なし（Wiki は空の状態で開始） |

各プリセットの **プロジェクトホームページ** には、自動生成された仕様書ページへのリンクや、タスク一覧・議事録ページへのリンクが含まれます。

> **Tips**: プリセットで生成されたページは通常のWikiページと同じです。自由に編集・削除・追加できます。

### レガシーテンプレート（旧方式）

プリセット機能の導入以前に作成されたプロジェクトでは、Wiki に初めてアクセスした際にページが0件の場合、以下のデフォルトテンプレートが自動で生成されます。

#### 1. プロジェクトホーム

| セクション | 内容 |
|-----------|------|
| プロジェクト概要 | プロジェクト名、目的、スコープ、期間の入力欄 |
| 体制・連絡先 | PM、開発リーダー、クライアント担当者の表 |
| 仕様・ドキュメント | 各仕様書ページへのリンク（自動生成） |
| 重要な決定事項 | 日付、内容、背景、決定者の記録表 |
| 最新の議事録 | 直近5件の議事録を自動表示するカスタムブロック |
| 関連ページ | タスク一覧、議事録、設定へのリンク |

#### 2. API仕様書

- ベースURL、認証方式、エンドポイント一覧（表形式）、エラーコード一覧

#### 3. DB設計書

- テーブル一覧、テーブル定義（カラム名、型、NOT NULL、説明）、リレーション、インデックス

#### 4. UI仕様書

- 画面一覧（画面名、パス、説明、ステータス）、デザインシステム情報、画面仕様テンプレート

> **注意**: レガシーテンプレートはプリセット未選択（旧方式）のプロジェクトのみに適用されます。新規プロジェクトではプリセット選択時にテンプレートが決まるため、この自動生成は行われません。

---

## ページ一覧

### 表示

- 更新日時の降順（最近更新されたページが上）で表示されます
- 各ページのタイトルとタグが表示されます
- ページをクリックするとエディタが開きます

### ページの検索

タグによるフィルタリングでページを絞り込めます。デフォルトテンプレートのタグ例:

| タグ | 対象ページ |
|------|-----------|
| ホーム | プロジェクトホームページ |
| テンプレート | テンプレートから生成されたページ |
| 仕様書 | 仕様書カテゴリのページ |
| API | API仕様書 |
| DB | DB設計書 |
| UI | UI仕様書 |

---

## 新規ページ作成

### 手順

1. Wiki 画面で **「新規ページ」ボタン** をクリック
2. ページタイトルを入力
3. 必要に応じてタグを設定
4. ページが作成され、エディタが開きます

> **Tips**: ページ作成はオプティミスティック更新で即座に一覧に反映されます。サーバーとの通信に失敗した場合は自動的にロールバックされます。

---

## ページ編集

### エディタの使い方

Wiki のエディタは BlockNote ベースのリッチテキストエディタです。以下の要素を使用できます。

| 要素 | 説明 |
|------|------|
| 見出し（H2, H3） | セクションの区切り |
| 段落 | 通常のテキスト |
| 箇条書き | 項目のリスト |
| テーブル | 表形式のデータ |
| リンク | 他のページやURLへのリンク |
| 太字・斜体 | テキストのスタイリング |
| コードブロック | コードやパスの表示 |

### バージョン管理

- ページの本文（body）を更新するたびに、バージョンスナップショットが自動で保存されます
- 過去のバージョン一覧を確認できます
- バージョン管理はバックグラウンドで行われ、保存失敗してもページの更新には影響しません

### ページの削除

1. 対象のページを開きます
2. **削除ボタン** をクリックします
3. 確認ダイアログで「OK」をクリックします

> **注意**: 削除されたページは復元できません。重要なページは削除前にバージョン履歴を確認してください。

---

## カスタムブロック

Wiki エディタでは、通常の Markdown 要素に加えて、特別なカスタムブロックを使用できます。

### 議事録リストブロック（meetingsList）

プロジェクトの最新の議事録を自動で表示するブロックです。

- プロジェクトホームのデフォルトテンプレートに含まれています
- 指定した件数の最新議事録を自動表示
- 表示件数はプロパティで制御可能（デフォルト: 5件）

### 決定事項ブロック

プロジェクトの決定事項を構造化して記録するためのテーブルブロックです。

| 列 | 説明 |
|----|------|
| 日付 | 決定された日付 |
| 決定内容 | 具体的な決定事項 |
| 背景・理由 | 決定の背景や理由 |
| 決定者 | 誰が決定したか |

### 要件ブロック

仕様の要件を記載するための構造化ブロックです。仕様書テンプレートで使用されています。

### サンプルブロック

テーブル形式でサンプルデータや設定例を記載するブロックです。

---

## タスクとの連携

### spec_path 形式

仕様タスク（type = `spec`）は、Wiki ページの特定のセクションと紐づけられます。

#### パス形式

```
/spec/ファイル名.md#アンカー
```

#### 例

```
/spec/API_SPEC.md#authentication
/spec/REVIEW_SPEC.md#meeting-minutes
/spec/DB_DESIGN.md#users-table
```

| 要素 | 説明 |
|------|------|
| `/spec/` | 仕様書であることを示すプレフィックス（必須） |
| ファイル名 | 仕様書を識別する名前 |
| `#アンカー` | ページ内の特定セクションを指すアンカー（必須） |

### 仕様タスクから Wiki ページへのリンク

タスクインスペクターの仕様タスクセクションに spec_path がリンクとして表示されます。

1. タスク一覧で仕様タスク（紫色のバッジ）をクリック
2. インスペクターの「仕様タスク」セクションで spec_path のリンクをクリック
3. 対応する Wiki ページが開きます

### 議事録からのタスク自動生成

会議の議事録に SPEC 記法で記述すると、仕様タスクが自動生成されます。生成されたタスクの spec_path は議事録の SPEC() 内のパスが設定されます。

```markdown
- [ ] SPEC(/spec/API_SPEC.md#auth): 認証APIの仕様を確定
```

上記の記述から以下のタスクが生成されます:

- タイプ: spec（仕様タスク）
- タイトル: 認証APIの仕様を確定
- spec_path: /spec/API_SPEC.md#auth
- 決定状態: considering（検討中）

> **Tips**: 詳細は「会議管理マニュアル」の議事録機能セクションを参照してください。

---

## リンクスタイリング

Wiki 内のリンクは、リンク先の種類に応じてスタイリングされます。

| リンク種類 | 表示 |
|-----------|------|
| Wiki内リンク | プロジェクト内の他のWikiページへのリンク |
| タスクリンク | タスク一覧への直接リンク |
| 議事録リンク | 議事録ページへのリンク |
| 外部リンク | 外部URLへのリンク |

### Wiki 内リンクの形式

プロジェクトホームから各仕様書ページへのリンクは以下の形式です。

```
/:orgId/project/:spaceId/wiki?page=<ページID>
```

デフォルトテンプレートでは、仕様書ページへのリンクが自動的に設定されます。

---

## ページの公開（パブリケーション）

Wiki ページをマイルストーンに紐づけて公開できます。

### 手順

1. 公開したいページを開きます
2. **公開ボタン** をクリックします
3. 紐づけるマイルストーンを選択します
4. 公開が実行されます

### 公開の仕組み

- 公開時点のページ内容（タイトル・本文）がスナップショットとして保存されます
- 元のページを編集しても、公開済みのスナップショットには影響しません
- 同じページを異なるマイルストーンに複数回公開可能です

| フィールド | 説明 |
|-----------|------|
| source_page_id | 公開元のWikiページ |
| milestone_id | 紐づけたマイルストーン |
| published_title | 公開時点のタイトル |
| published_body | 公開時点の本文 |
| published_by | 公開した人 |

---

## よくある使い方

### プロジェクト開始時

1. プロジェクト作成時にプリセットを選択すると、Wiki テンプレートが自動生成される
2. プロジェクトホームを編集して基本情報を記入
3. 各仕様書テンプレートを編集して初期仕様を記載

> **Tips**: 「白紙から始める」で作成した場合は、「新規ページ」ボタンから手動でページを追加してください。

### 会議での仕様決定時

1. 議事録に SPEC 記法で仕様タスクを記載
2. 会議終了後、自動生成されたタスクを確認
3. 対応する Wiki ページの仕様を更新
4. タスクの決定状態を `decided`（決定済み）に変更

### マイルストーン完了時

1. 完了する仕様書ページを確認・最終更新
2. マイルストーンに紐づけてページを公開
3. 公開スナップショットがクライアントへの納品物となる

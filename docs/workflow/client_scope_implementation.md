# Client Scope å®Ÿè£…ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

## æ¦‚è¦

ã‚¿ã‚¹ã‚¯ã« `client_scope` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒãƒ¼ã‚¿ãƒ«ã§ã®å¯è¦–æ€§ã‚’åˆ¶å¾¡ã™ã‚‹ã€‚

### ç›®çš„
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã€Œç´å“ç‰©ã«é–¢é€£ã™ã‚‹ã‚¿ã‚¹ã‚¯ã€ã®é€²æ—ã‚’è¦‹ã›ã‚‹
- å†…éƒ¨çš„ãªæŠ€è¡“ä½œæ¥­ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ã€ã‚¤ãƒ³ãƒ•ãƒ©ç­‰ï¼‰ã¯éè¡¨ç¤º
- å…¥åŠ›ã®æ‰‹é–“ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹

---

## ç¢ºå®šä»•æ§˜

| é …ç›® | æ±ºå®š |
|------|------|
| ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | `deliverable`ï¼ˆè¦‹ã›ã‚‹ï¼‰ |
| æ—¢å­˜ã‚¿ã‚¹ã‚¯ç§»è¡Œ | å…¨ã¦ `deliverable` |
| specï¼ˆä»•æ§˜ï¼‰| é¸æŠå¯èƒ½ï¼ˆå›ºå®šã—ãªã„ï¼‰ |
| MCPå¯¾å¿œ | âœ… task_create, task_update, task_list ã§æ“ä½œå¯èƒ½ |

---

## Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¤‰æ›´

### 1.1 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ

```sql
-- ã‚¿ã‚¹ã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«ã« client_scope ã‚’è¿½åŠ 
ALTER TABLE tasks ADD COLUMN client_scope text
  NOT NULL DEFAULT 'deliverable'
  CHECK (client_scope IN ('deliverable', 'internal'));

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼ˆãƒãƒ¼ã‚¿ãƒ«ã‚¯ã‚¨ãƒªç”¨ï¼‰
CREATE INDEX IF NOT EXISTS tasks_client_scope_idx ON tasks(client_scope);

-- ã‚³ãƒ¡ãƒ³ãƒˆ
COMMENT ON COLUMN tasks.client_scope IS
  'deliverable: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒãƒ¼ã‚¿ãƒ«ã«è¡¨ç¤º, internal: éè¡¨ç¤º';
```

### 1.2 å‹å®šç¾©æ›´æ–°

```typescript
// src/types/database.ts
interface Task {
  // ... existing fields
  client_scope: 'deliverable' | 'internal'
}
```

---

## Phase 2: UIå®Ÿè£… - ã‚¿ã‚¹ã‚¯ä½œæˆ/ç·¨é›† (2æ—¥)

### 2.1 UXãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆCodexæ¨å¥¨æ¡ˆï¼‰

**åŸå‰‡**: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç¶™æ‰¿ + ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ãƒˆã‚°ãƒ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¿ã‚¹ã‚¯ä½œæˆ                              [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ã‚¿ã‚¤ãƒˆãƒ«: [________________________]        â”‚
â”‚                                             â”‚
â”‚ ğŸ‘ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¡¨ç¤º  [ON]  â† ãƒˆã‚°ãƒ«      â”‚
â”‚                                             â”‚
â”‚ èª¬æ˜: [____________________________]        â”‚
â”‚       [____________________________]        â”‚
â”‚                                             â”‚
â”‚ æœŸé™: [____]  æ‹…å½“: [____]  ç¨®åˆ¥: [ã‚¿ã‚¹ã‚¯â–¼]â”‚
â”‚                                             â”‚
â”‚                          [ã‚­ãƒ£ãƒ³ã‚»ãƒ«] [ä½œæˆ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®æ±ºå®šãƒ­ã‚¸ãƒƒã‚¯

```typescript
function getDefaultClientScope(context: {
  parentMilestone?: { client_scope: string }
  taskType?: 'task' | 'spec'
}): 'deliverable' | 'internal' {
  // 1. è¦ªãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ãŒã‚ã‚Œã°ç¶™æ‰¿
  if (context.parentMilestone?.client_scope) {
    return context.parentMilestone.client_scope as 'deliverable' | 'internal'
  }

  // 2. specï¼ˆä»•æ§˜ï¼‰ã¯å¸¸ã«deliverable
  if (context.taskType === 'spec') {
    return 'deliverable'
  }

  // 3. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯deliverableï¼ˆè¦‹ã›ã‚‹æ–¹ãŒå®‰å…¨ï¼‰
  return 'deliverable'
}
```

### 2.3 ä¸€è¦§è¡¨ç¤ºã®ã‚¢ã‚¤ã‚³ãƒ³

```
ã‚¿ã‚¹ã‚¯ä¸€è¦§:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘ ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½å®Ÿè£…          é€²è¡Œä¸­   ç”°ä¸­    â”‚  â† deliverable
â”‚ ğŸ”’ DBã‚¯ã‚¨ãƒªãƒªãƒ•ã‚¡ã‚¯ã‚¿        é€²è¡Œä¸­   ä½è—¤    â”‚  â† internal
â”‚ ğŸ‘ æ±ºæ¸ˆç”»é¢ãƒ‡ã‚¶ã‚¤ãƒ³ç¢ºèª      ç¢ºèªå¾…ã¡ ã‚¯ãƒ©ã‚¤ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã‚¢ã‚¤ã‚³ãƒ³:
- ğŸ‘ (Eye) = deliverable = ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¦‹ãˆã‚‹
- ğŸ”’ (Lock) = internal = å†…éƒ¨ã®ã¿
```

---

## Phase 3: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒãƒ¼ã‚¿ãƒ«å¯¾å¿œ (1æ—¥)

### 3.1 ã‚¯ã‚¨ãƒªä¿®æ­£

```typescript
// src/app/portal/page.tsx

// ç¢ºèªå¾…ã¡ï¼ˆball='client'ï¼‰â†’ å…¨ã¦è¡¨ç¤ºï¼ˆå¤‰æ›´ãªã—ï¼‰
const { data: clientBallTasks } = await supabase
  .from('tasks')
  .select('...')
  .eq('space_id', spaceId)
  .eq('ball', 'client')
  .neq('status', 'done')

// é€²è¡Œä¸­ã‚¿ã‚¹ã‚¯ï¼ˆball='internal' ã‹ã¤ scope='deliverable'ï¼‰â†’ æ–°è¦è¿½åŠ 
const { data: inProgressTasks } = await supabase
  .from('tasks')
  .select('id, title, status, due_date, type')
  .eq('space_id', spaceId)
  .eq('ball', 'internal')
  .eq('client_scope', 'deliverable')  // â† è¿½åŠ 
  .neq('status', 'done')
  .order('due_date', { ascending: true })
```

### 3.2 ãƒãƒ¼ã‚¿ãƒ«UIè¿½åŠ 

```
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¢ºèªå¾…ã¡ã®ã‚¿ã‚¹ã‚¯ (3ä»¶)        â† æ—¢å­˜      â”‚
â”‚ â”œâ”€ ä»•æ§˜æ›¸A ã®æ‰¿èª                           â”‚
â”‚ â”œâ”€ ãƒ‡ã‚¶ã‚¤ãƒ³æ¡ˆB ã®ç¢ºèª                       â”‚
â”‚ â””â”€ ç”»é¢C ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€²è¡Œä¸­ã®ä½œæ¥­ (5ä»¶)            â† æ–°è¦è¿½åŠ   â”‚
â”‚ â”œâ”€ ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½å®Ÿè£…      [é€²è¡Œä¸­] 1/15æœŸé™  â”‚
â”‚ â”œâ”€ æ±ºæ¸ˆæ©Ÿèƒ½é–‹ç™º          [é€²è¡Œä¸­] 1/20æœŸé™  â”‚
â”‚ â””â”€ ... (èª­ã¿å–ã‚Šå°‚ç”¨ã€è©³ç´°ãªã—)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 4: ä¸€æ‹¬ç·¨é›†æ©Ÿèƒ½ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³, 1æ—¥)

### 4.1 ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¿½åŠ 

```
ã‚¿ã‚¹ã‚¯ä¸€è¦§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:
[ã™ã¹ã¦â–¼] [ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹â–¼] [æ‹…å½“â–¼] [å¯è¦–æ€§â–¼]
                                    â”œâ”€ ã™ã¹ã¦
                                    â”œâ”€ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¡¨ç¤º
                                    â””â”€ å†…éƒ¨ã®ã¿
```

### 4.2 ä¸€æ‹¬å¤‰æ›´

```
é¸æŠä¸­: 3ä»¶
[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¡¨ç¤ºã«å¤‰æ›´] [å†…éƒ¨ã®ã¿ã«å¤‰æ›´] [å‰Šé™¤]
```

---

## å®Ÿè£…å„ªå…ˆåº¦

| Phase | å†…å®¹ | å·¥æ•° | å„ªå…ˆåº¦ |
|-------|------|------|--------|
| 1 | DBå¤‰æ›´ + å‹å®šç¾© | 0.5æ—¥ | å¿…é ˆ |
| 2 | ã‚¿ã‚¹ã‚¯ä½œæˆ/ç·¨é›†UI | 1.5æ—¥ | å¿…é ˆ |
| 3 | ãƒãƒ¼ã‚¿ãƒ«è¡¨ç¤º | 1æ—¥ | å¿…é ˆ |
| 4 | ä¸€æ‹¬ç·¨é›† | 1æ—¥ | å¾Œå›ã—å¯ |

**MVPåˆè¨ˆ: 3æ—¥**

---

## ç¢ºèªäº‹é …

1. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**: `deliverable`ï¼ˆè¦‹ã›ã‚‹ï¼‰ã§è‰¯ã„ã‹ï¼Ÿ
   - å®‰å…¨å´ã«å€’ã™ãªã‚‰ã€Œè¦‹ã›ã‚‹ã€ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
   - å†…éƒ¨ä½œæ¥­ãŒå¤šã„ãªã‚‰ã€Œè¦‹ã›ãªã„ã€ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ–¹ãŒæ¥½ã‹ã‚‚

2. **æ—¢å­˜ã‚¿ã‚¹ã‚¯ã®ç§»è¡Œ**: å…¨ã¦ `deliverable` ã§è‰¯ã„ã‹ï¼Ÿ

3. **ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ç¶™æ‰¿**: ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã«ã‚‚ `client_scope` ã‚’è¿½åŠ ã™ã‚‹ã‹ï¼Ÿ

4. **specï¼ˆä»•æ§˜ï¼‰ã®æ‰±ã„**: å¸¸ã« `deliverable` å›ºå®šã§è‰¯ã„ã‹ï¼Ÿ

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ç¢ºèªäº‹é …ã®å›ç­”ã‚’ã„ãŸã ã„ãŸã‚‰ `/sc:implement` ã§å®Ÿè£…é–‹å§‹ã€‚

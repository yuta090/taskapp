# TaskApp ストロングポイント

TaskAppの設計における差別化ポイントと競合優位性をまとめたドキュメント。

---

## 1. ボール所有権（Ball Ownership）

### 概念
すべてのタスクに`ball`属性があり、**誰が次にアクションを取るべきか**を明確化。

```
ball = 'client'    → クライアントが対応待ち
ball = 'internal'  → 社内が対応中
```

### 競合との違い

| ツール | 「待ち」の表現 | 問題点 |
|--------|---------------|--------|
| Jira | カスタムステータス | 手動、不統一、強制力なし |
| Asana | カスタムフィールド/タグ | ワークフロー連携なし |
| Linear | ラベル | 監査証跡なし |
| Notion | プロパティ | 自由すぎて統一困難 |
| **TaskApp** | **ファーストクラスの`ball`属性** | **RPC強制、監査ログ、ダッシュボード優先表示** |

### メリット
- **機械的な説明責任**: `ball=client`のとき担当者アサイン必須（RPC制約）
- **自動優先順位付け**: クライアントポータルでは`ball=client`タスクが最上位表示
- **双方向追跡**: `ball`（誰が次か）と`origin`（誰が起票したか）の両方を記録

---

## 2. 監査グレードの意思決定記録

### Actor vs On-Behalf-Of分離

```typescript
actor_id           // 入力した人（社内スタッフ）
payload.on_behalf_of    // 誰の意思決定か（client/internal）
payload.client_confirmed_by  // 確認したクライアント担当者
payload.evidence   // 証跡種別（meeting/chat/email/call/other）
```

### ユースケース
1. **法的証拠**: 「誰がこの決定を承認したか？」に即答可能
2. **紛争解決**: 「クライアントが2024-01-15にメールで確認」の記録
3. **コンプライアンス**: SOC 2 / ISO 27001対応の不変監査証跡

### 競合との違い
他のPMツールにはこのレベルの**代理入力と確認者の分離**機能がない。

---

## 3. ミーティング駆動ワークフロー

### 機能

| 機能 | 従来のPMツール | TaskApp |
|------|---------------|---------|
| ミーティング連携 | カレンダー同期のみ | **会議開始まで決定ロック** |
| 決定の帰属 | 手動メモ | **自動で会議・参加者に紐付け** |
| 会議後サマリー | 手動エクスポート | **自動生成（決定/未決カウント付き）** |
| 通知 | 別システム | **idempotent通知（dedupe_key）** |

### RPC関数
```sql
rpc_meeting_start(meeting_id)  -- 会議開始
rpc_meeting_end(meeting_id)    -- 会議終了（サマリー自動生成）
rpc_generate_meeting_minutes(meeting_id)  -- 議事録生成
```

### メリット
- ガバナンス強化: 会議中のみ決定可能
- 自動サマリー: 決定件数、未決件数、クライアント待ち件数
- クライアント通知: 内部情報を自動除外した通知生成

---

## 4. 仕様タスク（Spec Task）ワークフロー

### 専用ライフサイクル
```
considering → decided → implemented
```

### 必須項目
- `spec_path`: 仕様書へのリンク（例: `/spec/v1/auth.md#password-reset`）
- `decision_state`: 決定状態

### DB制約
```sql
-- 仕様タスクはspec_pathとdecision_stateが必須
CHECK (type != 'spec' OR (spec_path IS NOT NULL AND decision_state IS NOT NULL))
```

### メリット
- **単一の真実源**: 仕様はMarkdown、タスクは特定アンカーにリンク
- **要件追跡**: 要件からリリースまでのトレーサビリティ
- **DB強制**: 不完全な仕様タスクは作成不可

---

## 5. クライアントポータル（情報隠蔽）

### 機能
- トークンベースアクセス（クライアントにアカウント不要）
- `ball=client`タスクを最優先表示
- 内部メタデータ非表示（GitHub ID、内部ラベル等）

### 競合との違い

| ツール | クライアントアクセス | 問題点 |
|--------|-------------------|--------|
| Jira | 制限付きアカウント | 複雑な権限設定、情報漏洩リスク |
| Asana | ゲストアクセス | 内部タスクも見える可能性 |
| Notion | 共有ページ | 構造が見える、編集リスク |
| **TaskApp** | **専用ポータル** | **見せたいものだけ見せる** |

### URL構造
```
/portal/{token}  -- クライアント専用ビュー
```

---

## 6. AIファースト設計（MCP連携）

### 概念
**完全にAIで制御可能なタスク管理**

### MCP Server
```
packages/mcp-server/
├── tools/
│   ├── tasks.ts    -- タスクCRUD
│   ├── ball.ts     -- ボール管理
│   └── ...
└── bin/taskapp-mcp.js
```

### 利用可能ツール
| ツール | 説明 |
|--------|------|
| `task_create` | タスク作成 |
| `task_list` | タスク一覧 |
| `ball_pass` | ボール移動 |
| `dashboard_get` | ダッシュボード |

### メリット
- Claude Codeから直接タスク管理
- 開発中のタスク自動登録
- Webで人間（クライアント含む）が確認

---

## 7. UI/UXルール

### 3ペインレイアウト
```
[LeftNav: 240px] - [Main: flex-1] - [Inspector: 400px]
```

### 必須ルール
- **Inspectorはオーバーレイ禁止**: Mainペインをリサイズ
- **Amber-500**: クライアント可視要素を示す色
- **楽観的更新**: 保存ボタンなし
- **モーダル禁止**: 詳細編集はInspector/ポップオーバー/シートのみ

### メリット
- 一貫したUX
- 高速な操作感
- クライアント関連要素の視認性

---

## 8. データモデルの強み

### マルチテナント
```sql
org_id  -- 組織分離
space_id  -- プロジェクト分離
```

### RLS（Row Level Security）
- すべてのテーブルでRLS有効
- 組織間のデータ漏洩防止

### 監査ログ
```sql
task_events
├── actor_id      -- 操作者
├── action        -- アクション種別
├── payload       -- 詳細データ（JSON）
└── meeting_id    -- 関連会議（nullable）
```

---

## 9. 拡張予定機能

### Phase 2: GitHub連携
- コミット/PR自動同期
- タスク自動作成

### Phase 3: ガントチャート + 時間管理
- 自作ガントチャート（React + SVG）
- ボール所有時間トラッキング
- SLA監視

### Phase 4: 通知 + モバイル
- Slack/Email連携
- PWA対応

---

## 10. Developer-PM支援機能（利益と信頼の最大化）

### Spec to Estimate & Billing（仕様即見積もり）
- **機能**: 仕様書（Markdown）の行タスクに工数/単価を紐付け。
- **メリット**: 追加要件が発生した瞬間、ポータル上で「追加費用」が可視化され、ワンクリックで合意（発注）完了。「範囲内/外」の交渉コストをゼロにする。

### Auto-Newsletter（週次報告オートメーション）
- **機能**: 毎週金曜にAIが「今週のDone」「来週のPlan」「ボール保持者」を自動集計し、リッチなレポートを作成。
- **メリット**: 開発者は確認ボタンを押すだけ。作成時間ゼロで、クライアントに「丁寧なPM」という印象を与える。

### Contextual Glossary（コンテキスト翻訳）
- **機能**: クライアントポータル上の専門用語（デプロイ、マイグレーション等）に、AIがツールチップ解説を自動付与。
- **メリット**: 一般的な辞書ではなく「このプロジェクトにおける意味」を補足。「どういう意味？」への回答コストを削減し、クライアントの理解度を向上させる。

### Smart Slack Triage（チャット起案の自動化）
- **機能**: Slack上のやり取りから、AIが自動で「タスク候補」を抽出し、Inboxに下書き起案。
- **メリット**: 開発者はチャットログを追いかける必要なし。整理されたWeb UIで「承認」ボタンを押すだけでタスク化完了。入力コストを極限まで下げる。

---

## まとめ: 3つの柱

1. **ボール所有権** - 「誰が止めているか」が常に明確
2. **監査グレードの決定記録** - 証跡付きでクライアント承認を記録
3. **AIファースト** - MCP連携で完全自動化可能

**キャッチコピー:**
> 「誰のターンか、もう聞かなくていい。」

---

## 11. 競合分析と戦略的ポジショニング

### Q. なぜ他社のガントチャートは強力（かつ高価）なのか？

ユーザー様からのご質問「ガントチャートは他社はどんなところが強力なのですか？」への回答と、TaskAppの戦略的判断。

| 強力な機能 | 内容 | TaskAppが採用しない理由 |
| :--- | :--- | :--- |
| **依存関係の自動調整** | 「タスクAが遅れたら、依存するタスクB、Cの開始日も自動でズラす」機能。 | 実装難易度が極めて高く、バグの温床になりやすい。個人開発では「手動で調整」で十分なケースが大半。 |
| **リソース平準化** | 「Aさんの稼働が120%だから、Bさんにタスクを振る」可視化。 | 人数が多い組織向け機能。個人〜小規模チームにはオーバースペック。 |
| **クリティカルパス** | 「ここが遅れると全体が遅れる」経路の計算・ハイライト。 | 大規模PJ用。直感的な「マイルストーン管理」で代替可能。 |
| **ベースライン比較** | 「当初予定」と「実績」のズレを重ねて表示。 | 画面が複雑化し、スマホでの閲覧がほぼ不可能になる。 |

**結論:** これらを実装すると「低価格・軽快」は維持できません。TaskAppは**「マイルストーン（点）」の管理**に特化し、「線」の管理（ガント）は簡易的なものに留めます。

---

### 推奨機能（個人開発者が喜ぶ「勝利の機能」）

1.  **簡易日報・稼働ログの自動生成**
    *   **機能:** AIが「完了タスク」と「Gitコミット」から日報をワンクリック生成。
    *   **狙い:** クライアントへの「ちゃんとやっています」証明を自動化。フリーランスの信頼獲得ツール。

2.  **テンプレート配布（コンテンツ戦略）**
    *   **機能:** 「LP制作」「システム開発」など、典型的な仕様書(.md)とタスクセットをプリセット化。
    *   **狙い:** ユーザーの「プロジェクト開始の面倒くささ」をゼロにする。

3.  **請求書・見積書のPDF化**
    *   **機能:** TaskApp上のデータを、そのまま綺麗なPDF請求書として出力。
    *   **狙い:** 「合意→即請求」の体験。freee等の会計ソフト契約前の個人層に刺さる。

### 捨てるべき機能（やらない勇気）

*   ❌️ **チャット機能**: Slack/Discordに勝てない。通知連携に特化する。
*   ❌️ **ファイル管理・Wiki**: Google Drive/Notionを利用。URLリンクのみで管理。
*   ❌️ **複雑な権限管理**: 「閲覧用トークン」1つでシンプルに解決する。

### 社内チーム管理における「圧倒的」メリット（VS マイクロマネジメント）

TaskAppの「ボール」と「AI」は、対クライアントだけでなく、**「少人数の開発チーム（3〜10人）」の社内管理**でも劇的な効果を発揮します。

1.  **「進捗どう？」の撲滅 (Ball Ownership)**
    *   **課題:** リーダーはメンバーの作業状況が見えず、不安になって「あれどうなった？」と頻繁に確認し、メンバーの時間を奪いがちです。
    *   **解決:** 「今、誰がボールを持っているか」が可視化されるため、リーダーは聞く必要がありません。メンバーも「自分のターン」だけに集中でき、自律的なチームが育ちます。

2.  **「進捗会議」の廃止 (Auto-Reporting)**
    *   **課題:** 週に一度、全員の手を止めて「やったこと」を報告し合うだけの儀式的な会議。
    *   **解決:** AIが日々の活動からレポートを自動生成するため、進捗共有は非同期で完了します。会議は「相談」や「意思決定」だけの建設的な場に変わります。

3.  **社内政治・責任転嫁の防止 (Audit Logs)**
    *   **課題:** 「その仕様、誰が決めた？」「聞いてない」という社内トラブル。
    *   **解決:** 小さな決定でも全てログに残るため、経緯が透明化されます。責任の所在を巡る不毛な争いがなくなり、チームの心理的安全性が向上します。

### 結論
TaskAppは多機能管理ツール（Jira/Asana）を目指さず、**「エンジニアとクライアント（およびチームリーダー）の間の『調整』を全自動化するエージェント」**として位置づける。

---

## 12. 【開発余力があれば】実装すべきキラー機能（High Effort, High Return）

ユーザー様からの「開発自体ができれば有用な機能はありますか？」という問いへの回答。
もしリソースが許すなら、以下の機能はTaskAppの価値を**「管理ツール」から「優秀な秘書」**へと劇的に高めます。

### A. AIリスク予報 (AI Risk Forecast)
*   **機能:** ガントチャートのような「厳密な計算」はしませんが、**「今のペースだと、納期に間に合わない確率が80%見えています」**とAIがこっそり教えてくれる機能。
*   **なぜ有用か:** 人間（特にフリーランス）の見積もりは常に**楽観的**です。「このままだとヤバイ」と客観的なデータで警告してくれるパートナーは、孤独な開発者にとって何より心強いです。
*   **実装イメージ:** 過去の消化速度（Velocity）と残りタスク数を比較するシンプルなロジックで実装可能です。

### B. 実績ベースの見積もりアシスト (Evidence-based Estimation)
*   **機能:** 新しいタスクを作る際、**「前回似たような『認証機能』を作った時は、12時間かかりましたよ」**とAIが過去ログから提示してくれる機能。
*   **なぜ有用か:** フリーランスが最も消耗するのは「見積もりの不安」です。自分の過去の実績に基づく根拠があれば、自信を持ってクライアントに金額・工数を提示できます。
*   **実装イメージ:** タスク名や内容のベクトル検索で、過去の類似タスクを抽出して表示します。

### C. ドラッグ＆ドロップ「簡易」タイムライン
*   **機能:** 依存関係の自動調整（後ろのタスクを自動でズラす等）はしませんが、**「期間をマウスで伸ばす」「タスクを来週に移動する」**という操作だけはビジュアルに行える画面。
*   **なぜ有用か:** 日付をプルダウンで入力するのは面倒です。スマホやタブレットで「指で予定を動かせる」体験は、管理のストレスを大幅に減らします。
*   **実装イメージ:** 既存のライブラリ（`dnd-kit`等）を活用し、「見た目の操作」だけに特化すれば、低コストで実装可能です。

---

## 12.1 キラー機能レビュー結果（Claude Opus + Codex GPT Architect 合同レビュー）

### 競合ガント機能の採用判定

| 競合機能 | 判定 | Claude | Codex | 理由 |
|:---|:---|:---|:---|:---|
| **依存関係の自動調整** | **簡易版採用** | 簡易版 | 簡易版 | フル自動シフトは不要。矢印線の可視化のみ実装。`ball=client`依存元を赤強調で「顧客待ち連鎖遅延」を可視化 |
| **リソース平準化** | **保留** | 不採用 | 簡易版 | 小規模チームでは優先度低。将来の週次負荷ヒートマップとして検討 |
| **クリティカルパス** | **不採用** | 不採用 | 不採用 | ボール滞留管理で代替済み。依存データ未整備時の誤判定リスク大 |
| **ベースライン比較** | **簡易版採用** | 簡易版 | 簡易版 | 重ね描画はせず差分バッジ（`+3日遅延`）のみ。Inspectorでテキスト詳細表示 |

### 提案3機能の評価

| 機能 | 差別化 | 難易度 | 優先度 | ボール所有権との相乗効果 |
|:---|:---|:---|:---|:---|
| **B: 実績ベース見積もり** | **唯一無二** | Medium | **1** | 「作業12h + 顧客確認平均3日」と分離提示 → 見積書の説得力が段違い |
| **A: AIリスク予報** | **高い** | Medium | **2** | `ball=client`滞留日数で「顧客待ち遅延確率」を算出 → 他ツールにない |
| **C: D&Dタイムライン** | **低い** | Quick | **3** | 既にUI実装済み。`start_date`永続化で「既存機能の完成」として扱う |

### 戦略的結論

> **「工程管理ガントではなく、ボール滞留管理ガントに進化させる」** — Claude・Codex完全合意

**実装ロードマップ:**
1. **Phase 0 (Quick):** `start_date` DB永続化 + D&D完成度向上
2. **Phase 1 (Medium):** 実績ベース見積もりアシスト（類似タスク検索 + 作業/待ち時間分離）
3. **Phase 2 (Medium):** AIリスク予報（ball滞留ベースの遅延確率、ルールベースから開始）
4. **Phase 3 (Short〜Medium):** 依存関係矢印表示 + ベースライン差分バッジ

---

## 13. バグ報告・品質管理の戦略 (Bug Reporting Strategy)

ユーザー様からの「顧客が簡単にバグ起票を行えて、それを管理できるようにしたい」という要望への解答。

### 競合他社のアプローチと課題

| 手法 | 代表ツール | 課題 |
| :--- | :--- | :--- |
| **高機能チケット** | **Jira Software**, **Backlog** | 顧客にアカウント作成とログインが必要。入力項目が多く（環境、再現手順など）、ITリテラシーがない顧客にはハードルが高い。「使い方がわからない」と言われ、結局メールで来る。 |
| **専用デスク** | **Jira Service Management** | 非常に高価。大規模サポートセンター向けで、受託開発にはオーバースペック。 |
| **フォーム/メール** | **Google Form**, **Email/Chat** | 最も一般的だが、**タスク管理ツールと分断される**。「メールを見て転記する」作業が発生し、ステータス（直ったのか？）が顧客に見えない。 |

### TaskAppの解答: 「ポータル直結・ワンストップ報告」

TaskAppは、**「クライアントポータルの中に、極めてシンプルな報告窓口を置く」**ことで解決します。

1.  **認証不要の報告フォーム**
    *   ポータル（閲覧用URL）の右下に常に「＋バグ・要望を報告」ボタンを表示。
    *   ログイン不要で、その場ですぐに入力可能。

2.  **AIトリアージ（一次受け）**
    *   顧客が「動かない」とだけ書いても、裏側でAIが**「どのようなエラーが表示されましたか？画面のスクリーンショットはありますか？」**と、チャット形式で補足情報を聞き出す（将来的な拡張）。
    *   エンジニアに届く頃には、ある程度情報が整理された状態にする。

3.  **「未確定（Triage）」ステータス**
    *   顧客が報告した直後は、タスク一覧には混ざらず「未確認ボックス」に入ります。
    *   エンジニアが内容を見て、**「これはバグ（修正対応）」「これは仕様（却下/説明）」**と振り分けることで、タスクリストの汚染を防ぎます。
    *   バグとして承認された瞬間、`ball: internal`（エンジニア持ち）として正式にタスク化されます。

4.  **「運用保守」フェーズでの活用**
    *   納品後もポータルを残しておくことで、「何かあったらここから送ってください」と言えます。
    *   「運用保守契約」内での対応か、追加見積もりが必要かも、この「トリアージ」の段階で判断し、顧客に通知できます。

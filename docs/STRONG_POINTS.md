# TaskApp ストロングポイント

TaskAppの設計における差別化ポイントと競合優位性をまとめたドキュメント。

---

## 1. ボール所有権（Ball Ownership）

### 概念
すべてのタスクに`ball`属性があり、**誰が次にアクションを取るべきか**を明確化。

```
ball = 'client'    → クライアントが対応待ち
ball = 'internal'  → 社内が対応中
```

### 競合との違い

| ツール | 「待ち」の表現 | 問題点 |
|--------|---------------|--------|
| Jira | カスタムステータス | 手動、不統一、強制力なし |
| Asana | カスタムフィールド/タグ | ワークフロー連携なし |
| Linear | ラベル | 監査証跡なし |
| Notion | プロパティ | 自由すぎて統一困難 |
| **TaskApp** | **ファーストクラスの`ball`属性** | **RPC強制、監査ログ、ダッシュボード優先表示** |

### メリット
- **機械的な説明責任**: `ball=client`のとき担当者アサイン必須（RPC制約）
- **自動優先順位付け**: クライアントポータルでは`ball=client`タスクが最上位表示
- **双方向追跡**: `ball`（誰が次か）と`origin`（誰が起票したか）の両方を記録

---

## 2. 監査グレードの意思決定記録

### Actor vs On-Behalf-Of分離

```typescript
actor_id           // 入力した人（社内スタッフ）
payload.on_behalf_of    // 誰の意思決定か（client/internal）
payload.client_confirmed_by  // 確認したクライアント担当者
payload.evidence   // 証跡種別（meeting/chat/email/call/other）
```

### ユースケース
1. **法的証拠**: 「誰がこの決定を承認したか？」に即答可能
2. **紛争解決**: 「クライアントが2024-01-15にメールで確認」の記録
3. **コンプライアンス**: SOC 2 / ISO 27001対応の不変監査証跡

### 競合との違い
他のPMツールにはこのレベルの**代理入力と確認者の分離**機能がない。

---

## 3. ミーティング駆動ワークフロー

### 機能

| 機能 | 従来のPMツール | TaskApp |
|------|---------------|---------|
| ミーティング連携 | カレンダー同期のみ | **会議開始まで決定ロック** |
| 決定の帰属 | 手動メモ | **自動で会議・参加者に紐付け** |
| 会議後サマリー | 手動エクスポート | **自動生成（決定/未決カウント付き）** |
| 通知 | 別システム | **idempotent通知（dedupe_key）** |

### RPC関数
```sql
rpc_meeting_start(meeting_id)  -- 会議開始
rpc_meeting_end(meeting_id)    -- 会議終了（サマリー自動生成）
rpc_generate_meeting_minutes(meeting_id)  -- 議事録生成
```

### メリット
- ガバナンス強化: 会議中のみ決定可能
- 自動サマリー: 決定件数、未決件数、クライアント待ち件数
- クライアント通知: 内部情報を自動除外した通知生成

---

## 4. 仕様タスク（Spec Task）ワークフロー

### 専用ライフサイクル
```
considering → decided → implemented
```

### 必須項目
- `spec_path`: 仕様書へのリンク（例: `/spec/v1/auth.md#password-reset`）
- `decision_state`: 決定状態

### DB制約
```sql
-- 仕様タスクはspec_pathとdecision_stateが必須
CHECK (type != 'spec' OR (spec_path IS NOT NULL AND decision_state IS NOT NULL))
```

### メリット
- **単一の真実源**: 仕様はMarkdown、タスクは特定アンカーにリンク
- **要件追跡**: 要件からリリースまでのトレーサビリティ
- **DB強制**: 不完全な仕様タスクは作成不可

---

## 5. クライアントポータル（情報隠蔽）

### 機能
- トークンベースアクセス（クライアントにアカウント不要）
- `ball=client`タスクを最優先表示
- 内部メタデータ非表示（GitHub ID、内部ラベル等）

### 競合との違い

| ツール | クライアントアクセス | 問題点 |
|--------|-------------------|--------|
| Jira | 制限付きアカウント | 複雑な権限設定、情報漏洩リスク |
| Asana | ゲストアクセス | 内部タスクも見える可能性 |
| Notion | 共有ページ | 構造が見える、編集リスク |
| **TaskApp** | **専用ポータル** | **見せたいものだけ見せる** |

### URL構造
```
/portal/{token}  -- クライアント専用ビュー
```

---

## 6. AIファースト設計（MCP連携）

### 概念
**完全にAIで制御可能なタスク管理**

### MCP Server
```
packages/mcp-server/
├── tools/
│   ├── tasks.ts    -- タスクCRUD
│   ├── ball.ts     -- ボール管理
│   └── ...
└── bin/taskapp-mcp.js
```

### 利用可能ツール
| ツール | 説明 |
|--------|------|
| `task_create` | タスク作成 |
| `task_list` | タスク一覧 |
| `ball_pass` | ボール移動 |
| `dashboard_get` | ダッシュボード |

### メリット
- Claude Codeから直接タスク管理
- 開発中のタスク自動登録
- Webで人間（クライアント含む）が確認

---

## 7. UI/UXルール

### 3ペインレイアウト
```
[LeftNav: 240px] - [Main: flex-1] - [Inspector: 400px]
```

### 必須ルール
- **Inspectorはオーバーレイ禁止**: Mainペインをリサイズ
- **Amber-500**: クライアント可視要素を示す色
- **楽観的更新**: 保存ボタンなし
- **モーダル禁止**: 詳細編集はInspector/ポップオーバー/シートのみ

### メリット
- 一貫したUX
- 高速な操作感
- クライアント関連要素の視認性

---

## 8. データモデルの強み

### マルチテナント
```sql
org_id  -- 組織分離
space_id  -- プロジェクト分離
```

### RLS（Row Level Security）
- すべてのテーブルでRLS有効
- 組織間のデータ漏洩防止

### 監査ログ
```sql
task_events
├── actor_id      -- 操作者
├── action        -- アクション種別
├── payload       -- 詳細データ（JSON）
└── meeting_id    -- 関連会議（nullable）
```

---

## 9. 拡張予定機能

### Phase 2: GitHub連携
- コミット/PR自動同期
- タスク自動作成

### Phase 3: ガントチャート + 時間管理
- 自作ガントチャート（React + SVG）
- ボール所有時間トラッキング
- SLA監視

### Phase 4: 通知 + モバイル
- Slack/Email連携
- PWA対応

---

## 10. Developer-PM支援機能（利益と信頼の最大化）

### Spec to Estimate & Billing（仕様即見積もり）
- **機能**: 仕様書（Markdown）の行タスクに工数/単価を紐付け。
- **メリット**: 追加要件が発生した瞬間、ポータル上で「追加費用」が可視化され、ワンクリックで合意（発注）完了。「範囲内/外」の交渉コストをゼロにする。

### Auto-Newsletter（週次報告オートメーション）
- **機能**: 毎週金曜にAIが「今週のDone」「来週のPlan」「ボール保持者」を自動集計し、リッチなレポートを作成。
- **メリット**: 開発者は確認ボタンを押すだけ。作成時間ゼロで、クライアントに「丁寧なPM」という印象を与える。

### Contextual Glossary（コンテキスト翻訳）
- **機能**: クライアントポータル上の専門用語（デプロイ、マイグレーション等）に、AIがツールチップ解説を自動付与。
- **メリット**: 一般的な辞書ではなく「このプロジェクトにおける意味」を補足。「どういう意味？」への回答コストを削減し、クライアントの理解度を向上させる。

### Smart Slack Triage（チャット起案の自動化）
- **機能**: Slack上のやり取りから、AIが自動で「タスク候補」を抽出し、Inboxに下書き起案。
- **メリット**: 開発者はチャットログを追いかける必要なし。整理されたWeb UIで「承認」ボタンを押すだけでタスク化完了。入力コストを極限まで下げる。

---

## まとめ: 3つの柱

1. **ボール所有権** - 「誰が止めているか」が常に明確
2. **監査グレードの決定記録** - 証跡付きでクライアント承認を記録
3. **AIファースト** - MCP連携で完全自動化可能

**キャッチコピー:**
> 「誰のターンか、もう聞かなくていい。」

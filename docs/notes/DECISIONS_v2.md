# 意思決定ログ（会話から確定した前提）

## 分類（Bug / Client / Task）
- 「バグ」と「課題」は本質的に同じ“Task”として扱う。
- UI上は**メニューで分けない**（Bug専用メニューは不要）。
- ただし **フィルタ/ビューで `tasks.category=bug` を表示できる**ことは必須。
- クライアント起点は `tasks.category=client` のままでOK（一覧/フィルタで運用）。

## 作成（Create）
- Create Sheetは「どの画面を見ていても」起動できる（Cキー等）。
- 作成時：プロジェクト（space）は現在のコンテキストで自動認識。
- 担当者は任意（未割り当て許容）。未割り当てタスクはMissing扱いで回収フローあり。
- 作成後：Inspectorへ自動遷移して詳細入力。

## 未割り当て（Missing Recovery）
- `assignee_id IS NULL` は Missing とみなし、Inspector上部に固定アラートを出す。
- 未割り当て通知は「3（重要度の扱い）」として運用（会話上の決定）。

## PMロール（プロジェクト責任者）
- プロジェクトごとにPM/責任者は設定可能。
- **上限3人**まで。
- 優先順（誰が責任者っぽいか）は「Primary」を先頭にし、ローテ可能。

## Inspector開閉
- 同じ行をもう一度クリックしたらInspectorを閉じる（右の✕を押しに行かせない）。
- Escでも閉じる。

## 4K対策（視線移動）
- 右ペインが遠すぎる問題に対して、レイアウトの“寄せ”を入れる方向で調整（後続のprotoに反映）。


## レビュー（承認）基本仕様
- **指名なしレビュー**はデフォルトで「**1人承認で完了**」。将来「任意N人承認」に拡張可能。
- **差し戻し**は「ボタン操作＋理由必須」のみ。コメント投稿は差し戻し扱いにしない。
- 差し戻し後も他者の承認は保持。ただし**差し戻した本人は再承認必須**（blockedReviewerIdsで管理）。
- 差し戻しの解除は「差し戻した本人の再承認」で行う。

## クライアント向け文言（短め）
- クライアント側は「差し戻す」ではなく **「修正をお願いする」** を採用（内部処理はchanges_requested）。
- 「コメント＝修正依頼ではない」ことをUI上で明示する（混同防止）。

## ダッシュボード（開発画面）
- ダッシュボードに **マイルストーン一覧** と **決めないといけないこと（クライアント要確認）** を表示。
- マイルストーンは「期限が近い順」で並べ、期限が近いものは視覚的に強調する。
- マイルストーン完了条件（ダッシュボード表示用）：そのマイルストーン内の **クライアント要確認が0件**。

## 検討中（別ビュー）
- タスクに `status=considering` を追加し、「検討中」ビュー（タブ/メニュー）で分離表示する。

## ショートカット
- `s`（および Cmd/Ctrl+K）でクイック検索（タスク検索）を開く。

## レビュー表示
- Inspector内で「必須レビュアーごとの状態（未承認/承認済み/再承認待ち）」が分かる進捗表示を必須とする。

## ダッシュボード分離（社内 / クライアント）
- **クライアント用ダッシュボード**と**社内用ダッシュボード**は用途・情報設計・見た目を分離する（混ぜない）。
- クライアント用の真実（SoT）は `review.approvals / blockedReviewerIds / ball`（社内の `status=done` は参照しない）。
- 社内用は `status / assignee / priority` を中心にする（クライアント承認は要素の1つ）。

## 検討中（considering）と起案元（origin）
- `status=considering` を「検討中」ビューで分離表示する（社内側）。
- `origin: client | internal` をタスクに持ち、社内側の表示で起案元を区別できるようにする。

## ボール（ball）と担当者（owners）
- `ball: client | internal` をタスクに持ち、**次に動く側（ボールの所在）**を明示する。
- `clientOwnerIds`（先方担当者・複数可）/ `internalOwnerIds`（社内担当者・複数可）を持つ。
- 担当者必須化は「作成時」ではなく、**社内が `ball=client`（お客様確認に回す）にする瞬間**で行う（`clientOwnerIds` は1人以上必須）。
- 連続作成時は、直近の `clientOwnerIds` をデフォルト引き継ぎする（次の作成が面倒にならないように）。

## 社内からクライアントに投げる導線
- 社内Inspectorに **「お客様確認に回す」**（`ball=client`）と **「当社対応中に戻す」**（`ball=internal`）を置く。
- 「お客様確認に回す」押下時に、担当者未設定なら選択モーダルを出して必須入力させる。

## 監査ログ（events）
- 誰が何をしたかは `events`（task_events）で必ず記録する（担当変更/ボール変更/差し戻し/承認/解決など）。

## 通知（メール＋アプリ内）
- 通知チャネルは **メール＋アプリ内通知の両方**を基本とする。
- 最小通知トリガー：
  - `ball=client` になった瞬間（担当者へ通知）
  - 期限2日前のリマインド（担当者へ）
  - 期限超過（担当者へ＋社内へエスカレーション）

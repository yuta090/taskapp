# TaskApp プリモーテム分析レポート

**分析日**: 2026年2月15日
**前提**: 6ヶ月後（2026年8月）にTaskAppが失敗したと仮定し、今から修正可能な課題を洗い出す
**分析チーム**: 営業 / 開発 / 経営 / 外部コンサル / QA / セキュリティ / 料金戦略（計7視点）

---

## 総合評価

| 指標 | 値 |
|------|-----|
| **総合スコア** | **D (33/100)** |
| **半年後の失敗確率** | **85%以上**（現状のまま放置した場合） |
| **発見された問題数** | CRITICAL 9 / HIGH 15 / MEDIUM 12 / LOW 6 |
| **推定修正コスト（全対応）** | 3〜4人月 |

---

## TOP 5 失敗シナリオ

### 1. 収益化不能 — 売上ゼロのまま資金枯渇

料金ページが存在せず、Stripe連携は未完成、`useBillingLimits`はスタブ実装（常にnull返却）。Pro/Enterpriseの価格すら未決定。Freeプランの制限チェックが動作していないため、全ユーザーが無料で使い続ける。

### 2. クライアント離脱 — ポータルが使われなくなる

招待リンク30日失効、モバイル未対応（Inspector 400px固定幅）、エラー時にalert()でブロッキング、オンボーディングゼロ。初回体験の悪さからクライアントがポータルを放棄し、メール/Slackでの個別対応に逆戻りする。

### 3. セキュリティ侵害 — データ漏洩で信頼崩壊

RLS不完全、APIキー認可不足、ポータルトークンのブルートフォースリスク、`dangerouslySetInnerHTML`によるXSS脆弱性、セキュリティヘッダー未設定。マルチテナント分離がRLSのみに依存し、テストでの検証もない。

### 4. パフォーマンス崩壊 — 50社超で破綻

`force-dynamic`が全ページに適用されServer Component無効化、Middlewareが毎リクエスト`getUser()`実行（2-3回のDB往復）、ページネーション未実装（limit(50)ハードコード）、仮想化なし。

### 5. 障害検知不能 — 問題に気づけないまま顧客喪失

テストカバレッジ5%、Sentry等のエラー監視ゼロ、console.errorが250箇所（ブラウザで消失）、バックアップ/災害復旧計画なし、ヘルスチェックエンドポイントなし。

---

## 全課題一覧

### CRITICAL（9件）— 即座対応必須

| # | 課題 | 発見チーム | 影響 |
|---|------|-----------|------|
| C-1 | **料金ページが存在しない** | 料金 | CVR 0%、収益化不能 |
| C-2 | **Pro/Enterpriseの価格未定** | 料金 | 収益計画が立てられない |
| C-3 | **useBillingLimits がスタブ実装** | 料金・開発 | 制限チェック無効、Free乱用 |
| C-4 | **エラー監視ツールなし** | QA・経営 | 障害に気づけない（推定20-30%顧客喪失） |
| C-5 | **テストカバレッジ 5%** | QA | リグレッション検知不能 |
| C-6 | **RLS不完全 + テスト未検証** | セキュリティ | マルチテナントデータ漏洩リスク |
| C-7 | **招待リンク30日失効** | 営業 | 長期プロジェクトでクライアントがロックアウト |
| C-8 | **alert()によるエラー表示** | 営業 | UXブロッキング、プロ感ゼロ |
| C-9 | **災害復旧計画なし** | 経営 | データ喪失時に事業継続不能 |

### HIGH（15件）— 1ヶ月以内対応

| # | 課題 | 発見チーム | 影響 |
|---|------|-----------|------|
| H-1 | **force-dynamic 全ページ適用** | 外部コンサル | Server Component無効、TTFB悪化 |
| H-2 | **Middleware認証デデュプ未実施** | 外部コンサル・開発 | リクエストあたり2-3回のDB往復 |
| H-3 | **モバイル未対応（Inspector 400px固定）** | 営業 | スマホユーザー50%以上が挫折 |
| H-4 | **オンボーディング未実装** | 営業 | 初回訪問時に迷子、問い合わせ増 |
| H-5 | **楽観的更新のロールバック不完全** | QA | 関連データ不整合、UIとDB乖離 |
| H-6 | **レースコンディション対策が部分的** | QA | 並行編集でデータ消失（Last-Write-Wins） |
| H-7 | **レートリミットなし** | セキュリティ・経営 | API濫用、DDoS、料金爆発 |
| H-8 | **APIキー認可チェック不足** | セキュリティ | 他組織キーの操作可能リスク |
| H-9 | **XSS脆弱性（dangerouslySetInnerHTML）** | セキュリティ | SectionIndex.tsxで未サニタイズHTML |
| H-10 | **セキュリティヘッダー未設定** | セキュリティ | CSP/HSTS/X-Frame-Options なし |
| H-11 | **anyタイプ23ファイル + eslint-disable** | 開発 | 型安全性崩壊、バグ潜伏 |
| H-12 | **Supabaseクライアントパターン不統一** | 開発 | useRef/useMemo/bareが混在 |
| H-13 | **14日間トライアル表記の矛盾** | 料金 | Freeプランは無期限無料なのに誤表記 |
| H-14 | **承認取り消し不可** | 営業 | 誤操作時のリカバリー手段なし |
| H-15 | **Supabaseベンダーロックイン** | 経営 | 移行コスト推定5000万〜1億円 |

### MEDIUM（12件）— 3ヶ月以内対応

| # | 課題 | 発見チーム | 影響 |
|---|------|-----------|------|
| M-1 | **ページネーション未実装** | QA・経営 | limit(50)超のタスク閲覧不可 |
| M-2 | **外部API障害時のフォールバックなし** | QA | Supabase/Slack障害で全停止 |
| M-3 | **toISOString()が62箇所残存** | QA | 日本時間で1日ずれるバグ |
| M-4 | **入力バリデーション不完全** | QA | 50000文字入力でDBエラー |
| M-5 | **通知キュー/リトライなし** | QA | Slack送信失敗で通知消失 |
| M-6 | **複数プロジェクト対応未実装** | 営業 | 大口顧客に対応不可 |
| M-7 | **TaskInspector.tsx 1163行** | 開発 | 保守性崩壊、バグ発生率上昇 |
| M-8 | **消費税表示未対応** | 料金 | 日本市場で法的リスク |
| M-9 | **請求書払い未対応** | 料金 | 大手企業の稟議が通らない |
| M-10 | **FAQ/信頼シグナルなし** | 料金 | CVR低下、「怪しい」と判断 |
| M-11 | **Bus Factor 1** | 経営 | 仕様書20世代、属人化極大 |
| M-12 | **DB indexing不足** | 外部コンサル | クエリパフォーマンス劣化 |

### LOW（6件）— 監視継続

| # | 課題 | 発見チーム |
|---|------|-----------|
| L-1 | アクセシビリティ対応不十分 | 営業 |
| L-2 | 空状態（Empty State）UX不足 | QA |
| L-3 | Unicode/絵文字処理の未検証 | QA |
| L-4 | デザイントークン不統一 | 営業 |
| L-5 | ReviewList.tsx が欠落（コメントアウト） | 開発 |
| L-6 | Next.js 16 安定性未知数 | 経営 |

---

## チーム別分析サマリー

### 営業視点（20件発見）

**調査範囲**: クライアントポータル全体のUX、オンボーディング、モバイル対応

**核心メッセージ**: クライアントがポータルを放棄し、メール/Slackでの個別対応に逆戻りする

**主要発見**:
- 招待リンク30日失効でクライアントがロックアウトされる
- alert()によるブロッキングエラー表示がプロ感を損なう
- モバイルでInspector(400px)が画面を占有し操作不能
- 初回訪問時のウォークスルーが一切ない
- 承認の取り消し手段がない（誤操作時のリカバリー不可）
- セッション切れ時に/loginへリダイレクト（パスワードレスなのでログイン不可）
- コメント送信失敗時に入力内容が消える

**推奨TOP3**:
1. 招待リンク有効期限を90日以上または無期限に変更
2. alert()をトースト通知に全面置換
3. モバイルInspectorを全画面モーダルまたはbottom sheetに変更

---

### 開発チーム視点（15件発見）

**調査範囲**: コード品質、型安全性、パターン一貫性、技術的負債

**核心メッセージ**: anyタイプとeslint-disableの蔓延で型安全性が形骸化している

**主要発見**:
- 23ファイルでanyタイプ使用（特にPortal系8ファイルで`as any`パターン）
- Supabaseクライアント生成がuseRef/useMemo/bareの3パターン混在
- 環境変数がクライアントバンドルに露出するリスク
- TaskInspector.tsxが1163行（分割必須）
- ReviewList.tsxが欠落（index.tsでコメントアウト）

**推奨TOP3**:
1. anyタイプを段階的に排除（`SupabaseClient<Database>`型の統一使用）
2. Supabaseクライアントパターンをlazy useRefに統一
3. TaskInspector.tsxをロジック/表示/サブコンポーネントに分割

---

### 経営視点（12件発見）

**調査範囲**: ベンダーリスク、スケーラビリティ、収益化、競合優位性、BCP

**核心メッセージ**: 運用・スケーラビリティ・収益化の面で重大リスク。成長時に破綻する

**主要発見**:
- Supabase完全依存（RPC 369行、RLS全テーブル、認証）— 移行コスト推定5000万〜1億円
- 災害復旧計画ゼロ（PITR未確認、バックアップスクリプト不在）
- スケーラビリティ上限 — 現設計で推定50社・月商500万円が天井
- Bus Factor 1 — 仕様書16個・DDL 4バージョン・プロトタイプ20世代以上
- 競合優位性「ボール所有権」は模倣容易、特許なし

**推奨TOP3**:
1. Sentry統合 + ヘルスチェックエンドポイント実装（今週中）
2. Supabase PITR有効化 + 週次バックアップスクリプト作成（今週中）
3. Stripe連携を最優先実装（2週間スプリント）

---

### 外部コンサル視点（12件発見）— スコア: D+ (40/100)

**調査範囲**: アーキテクチャ、パフォーマンス、設計パターン

**核心メッセージ**: force-dynamicと認証デデュプの2つだけで体感速度が2-3倍改善可能

**主要発見**:
- `(internal)/layout.tsx`の`force-dynamic`が全子ページのSSG/ISRを無効化
- Middlewareが毎リクエスト`getUser()`実行（100ms〜300ms × 2-3回）
- 楽観的更新が中途半端（成功パスのみ、エラーパスのロールバック不完全）
- DB indexが不足（tasks複合インデックスなし）
- React Queryが`QueryClientProvider`のみでフック未使用

**推奨TOP3**:
1. `force-dynamic`を削除し、ページ単位で`dynamic`を制御
2. Middleware認証をキャッシュ（セッションクッキーベース）
3. 主要クエリにDB複合インデックス追加

---

### QA/信頼性視点（17件発見）

**調査範囲**: テストカバレッジ、エラーハンドリング、エッジケース、データ整合性

**核心メッセージ**: テストカバレッジ5%と監視ゼロの組み合わせが最大リスク

**主要発見**:
- ソースファイル356に対しユニットテスト19、E2Eテスト2
- クリティカルパス（ポータル承認、ボールパス）のテストがゼロ
- 楽観的更新のロールバックが部分的（タスク本体のみ、関連データは放置）
- ポータル承認ボタンに二重送信防止がない
- 外部サービス障害時のグレースフル・デグラデーションなし
- console.error 250箇所が全て消失（監視ツールなし）

**推奨TOP3**:
1. Sentry導入（2時間で完了、エラー可視化の即効薬）
2. ポータル承認フローのE2Eテスト追加（4時間）
3. 二重送信防止（isSubmittingステート）の実装（2時間）

---

### セキュリティ視点（13件発見）— リスク評価: HIGH

**調査範囲**: RLS、認証、入力検証、XSS、CSRF、APIセキュリティ

**核心メッセージ**: RLS不完全とセキュリティヘッダー未設定の組み合わせが危険

**主要発見**:
- RLSポリシーが一部テーブルで不完全（テストによる検証なし）
- APIキー管理（/api/keys）の認可チェックが不十分
- ポータルトークンがUUID v4のみ — ブルートフォース耐性に懸念
- `SectionIndex.tsx`で`dangerouslySetInnerHTML`使用（XSS脆弱性）
- next.config.tsにセキュリティヘッダー（CSP, HSTS, X-Frame-Options）なし
- レートリミットなし（全APIエンドポイント）

**推奨TOP3**:
1. next.config.tsにセキュリティヘッダー追加（1時間）
2. RLSポリシーの監査 + E2Eテスト追加（1日）
3. レートリミット実装（Upstash Redis、半日）

---

### 料金戦略視点（11件発見）

**調査範囲**: 料金ページ、プラン設計、Stripe連携、競合比較、日本市場最適化

**核心メッセージ**: 料金ページが存在しない。収益化の道筋がゼロ

**主要発見**:
- 専用の`/pricing`ページが存在しない（設定画面内の課金管理のみ）
- Pro/Enterpriseの価格が「TBD（未定）」
- `useBillingLimits`がスタブ（常にnull返却）— 制限チェック無効
- LP上の「14日間無料トライアル」がFreeプラン（無期限無料）と矛盾
- 消費税表示なし（日本では税込/税別の明記が法的に必須）
- 請求書払い未対応（大手企業の稟議が通らない）
- 年間/月間プライシングの選択肢なし

**推奨料金戦略**:

| プラン | 月額（税別） | 年額（税別） | ターゲット |
|--------|-------------|-------------|-----------|
| Free | 0円 | 0円 | 個人・5名以下チーム |
| Pro | 2,980円 | 29,800円（2ヶ月無料） | 成長中チーム（5〜20名） |
| Enterprise | 要相談（最低50,000円） | 要相談 | 大手企業 |

**競合比較**:

| ツール | 価格帯 | TaskAppとの差別化 |
|--------|--------|------------------|
| Asana Pro | $10.99/user/月（約1,650円） | TaskAppは定額制でコスパ優位 |
| ClickUp | $7/user/月（約1,050円） | TaskAppはAI統合が標準 |
| Backlog | 12,980円/月（30ユーザー） | TaskAppはクライアントポータルあり |

---

## アクションロードマップ

### Week 1-2: 生存フェーズ（即座対応）

**目標**: 致命的リスクの排除

| # | アクション | 工数 | 担当 | 対応課題 |
|---|-----------|------|------|---------|
| 1 | Sentry導入 | 2h | 開発 | C-4 |
| 2 | Supabase PITR有効化 | 1h | インフラ | C-9 |
| 3 | 週次バックアップスクリプト作成 | 4h | インフラ | C-9 |
| 4 | next.config.tsにセキュリティヘッダー追加 | 1h | 開発 | H-10 |
| 5 | alert()をトースト通知に置換 | 4h | フロント | C-8 |
| 6 | 招待リンク有効期限を90日に延長 | 2h | バックエンド | C-7 |
| 7 | 「14日間トライアル」表記の修正 | 30m | フロント | H-13 |
| 8 | ポータル承認ボタンの二重送信防止 | 2h | フロント | H-6 |
| 9 | 料金ページ（/pricing）作成 | 2d | フロント・企画 | C-1, C-2 |
| 10 | Pro/Enterprise価格決定 | - | 経営 | C-2 |

### Week 3-4: 安全+UXフェーズ

**目標**: セキュリティ強化とクライアント体験改善

| # | アクション | 工数 | 対応課題 |
|---|-----------|------|---------|
| 11 | RLSポリシー監査 + テスト追加 | 1d | C-6 |
| 12 | レートリミット実装（Upstash Redis） | 4h | H-7 |
| 13 | XSS脆弱性修正（dangerouslySetInnerHTML） | 2h | H-9 |
| 14 | モバイルInspector改修（bottom sheet） | 1d | H-3 |
| 15 | 初回ウォークスルー実装（3ステップ） | 1d | H-4 |
| 16 | Stripe連携完了 + useBillingLimits実装 | 3d | C-3, H-15経営 |
| 17 | force-dynamic削除 + ページ単位制御 | 4h | H-1 |
| 18 | Middleware認証キャッシュ | 4h | H-2 |

### Month 2: パフォーマンスフェーズ

**目標**: スケーラビリティ確保

| # | アクション | 工数 | 対応課題 |
|---|-----------|------|---------|
| 19 | カーソルベースページネーション実装 | 2d | M-1 |
| 20 | React Virtual導入（リスト仮想化） | 1d | M-1 |
| 21 | DB複合インデックス追加 | 4h | M-12 |
| 22 | anyタイプ段階的排除（23ファイル） | 3d | H-11 |
| 23 | TaskInspector.tsx分割 | 1d | M-7 |
| 24 | toISOString()の全置換（62箇所） | 1d | M-3 |
| 25 | 消費税表示 + 年間プランUI | 1d | M-8 |
| 26 | 外部APIリトライロジック実装 | 4h | M-2 |

### Month 3: 品質フェーズ

**目標**: テスト基盤確立と長期安定性

| # | アクション | 工数 | 対応課題 |
|---|-----------|------|---------|
| 27 | E2Eテスト拡充（カバレッジ30%目標） | 5d | C-5 |
| 28 | クリティカルパス単体テスト | 3d | C-5 |
| 29 | 楽観的ロック導入（versionカラム） | 2d | H-6 |
| 30 | Supabase依存低減（ORM層検討） | 3d | H-15 |
| 31 | 通知キュー導入（リトライ対応） | 2d | M-5 |
| 32 | FAQ + 信頼シグナル追加 | 1d | M-10 |
| 33 | 請求書払い対応（Stripe Invoicing） | 2d | M-9 |
| 34 | 新規開発者オンボーディングガイド | 1d | M-11 |

---

## 投資対効果マトリクス

```
高
影
響  ┌─────────────────────────────────────────────┐
度  │  [C-1 料金ページ]     [C-4 Sentry]          │
   │  [C-3 課金制限]       [H-1 force-dynamic]    │
   │  [C-6 RLS]           [H-2 認証デデュプ]      │
   │  [C-7 招待リンク]     [H-7 レートリミット]    │
   │                                              │
   │──────────────────────────────────────────────│
   │  [H-15 ベンダーロック] [C-5 テスト拡充]       │
   │  [M-1 ページネーション][H-11 any排除]         │
   │  [H-3 モバイル対応]   [M-7 Inspector分割]     │
低  │                                              │
   └─────────────────────────────────────────────┘
       低 ──────── 実装コスト ──────── 高
```

**最優先ゾーン（高影響・低コスト）**: C-4, H-1, H-2, C-7, H-7, C-8
**戦略的投資ゾーン（高影響・高コスト）**: C-1, C-3, C-6, C-5

---

## KPI目標（対策実施後）

| 指標 | 現状 | 3ヶ月後目標 | 6ヶ月後目標 |
|------|------|-----------|-----------|
| テストカバレッジ | 5% | 30% | 60% |
| エラー検知率 | 0% | 90% | 95% |
| TTFB（p95） | 推定2-3秒 | 800ms | 500ms |
| ポータルモバイル対応 | 非対応 | 基本対応 | 完全対応 |
| 有料転換率 | 0%（課金なし） | 5% | 10% |
| MRR（月間定期収益） | 0円 | 30万円 | 150万円 |
| クライアント満足度 | 未計測 | 70% | 85% |
| セキュリティスコア | D | B | A |
| スケーラビリティ上限 | 50社 | 200社 | 500社 |

---

## 結論

TaskAppは「ボール所有権」「MCP対応」「クライアントポータル」という優れた差別化要素を持つが、**収益化・運用・セキュリティ・品質保証**の4領域で重大な欠陥を抱えている。

現状のまま6ヶ月を経過した場合、以下の順序で失敗に至る:

1. **Month 1-2**: Freeプランユーザーのみ増加、収益ゼロ、インフラコスト増大
2. **Month 2-3**: セキュリティインシデントまたはデータ不整合が発生、気づかずに放置
3. **Month 3-4**: クライアントがポータルを放棄、メール対応に逆戻り
4. **Month 4-5**: パフォーマンス劣化で新規クライアント獲得停滞
5. **Month 5-6**: 資金枯渇または信頼喪失で事業継続不能

**ただし、本レポートのWeek 1-2アクション（工数約5日）を即座実行すれば、失敗確率を85%から40%以下に低減可能。** Month 2までの全アクション完了で20%以下まで改善できる。

最も重要なのは「料金ページ作成 + Stripe連携」と「Sentry導入 + セキュリティヘッダー」の同時着手である。収益の道筋と障害検知の仕組みを同時に確立することが、6ヶ月後の成功を左右する。

---

*本レポートは7チーム（営業・開発・経営・外部コンサル・QA・セキュリティ・料金戦略）による独立分析を統合したものです。*
